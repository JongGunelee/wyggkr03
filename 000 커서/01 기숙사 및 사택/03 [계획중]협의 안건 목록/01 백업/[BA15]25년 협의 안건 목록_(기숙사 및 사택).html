<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í˜‘ì˜ ë‚´ìš© ì‘ì„± ì‹œíŠ¸</title>
  <style>
    html, body {
      font-size: 18px;
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      margin: 0;
      padding: 0;
    }
    body.fullscreen-mode #controls {
      display: none;
    }
    h2 {
      margin: 10px 20px;
      cursor: text;
      font-size: 24px;
      padding-left: 0;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 10px;
      background: #eef8ff;
      font-size: 14px;
    }
    .group {
      position: relative;
      background: #eaf4ff;
      padding: 4px;
      border-radius: 6px;
      margin-right: 6px;
      min-width: 80px;
      max-width: fit-content;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      height: auto;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .group-title {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 2px;
      color: #2c5282;
      white-space: nowrap;
    }
    .group button {
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #999;
      background: #f2f2f2;
      border-radius: 4px;
      margin: 1px;
      white-space: nowrap;
      height: 20px;
      line-height: 1;
    }
    .group .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .group:nth-child(1) { background: #fff2e6; } /* íŒŒì¼ - ì—°í•œ ì£¼í™©ìƒ‰ */
    .group:nth-child(2) { background: #e6f3ff; } /* ì „ì²´í™”ë©´ - ì—°í•œ íŒŒë€ìƒ‰ */
    .group:nth-child(3) { background: #e6ffff; } /* ìŠ¤íƒ€ì¼ - ì²­ë¡ìƒ‰ */
    .group:nth-child(4) { background: #f0e6ff; } /* í•˜ì´í¼ë§í¬ - ì—°í•œ ë³´ë¼ìƒ‰ */
    .group:nth-child(5) { background: #fff0f5; } /* ìˆ«ì ì…ë ¥ - ì—°í•œ ë¶„í™ìƒ‰ */
    .group:nth-child(6) { background: #e6ffe6; } /* í•©ê³„ í–‰ - ì—°í•œ ì´ˆë¡ìƒ‰ */
    .group:nth-child(7) { background: #ffe6e6; } /* í–‰/ì—´ ì¡°ì‘ - ì—°í•œ ë¹¨ê°„ìƒ‰ */
    .group:nth-child(8) { background: #e6e6ff; } /* ì—´ í­ ì¡°ì • - ì—°í•œ íŒŒë€ìƒ‰ */
    .group:nth-child(9) { background: #fff8e6; } /* ë³‘í•© - ì—°í•œ ë…¸ë€ìƒ‰ */
    .group:nth-child(10) { background: #f0f0f0; } /* ì •ë ¬ - ì—°í•œ íšŒìƒ‰ */
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: auto;
      font-size: 18px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 3px;
      text-align: center;
      vertical-align: middle;
      resize: both;
      overflow: hidden;
      white-space: pre-wrap;
      min-height: 24px;
      height: 100%;
      line-height: 1.2;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    th[contenteditable="true"], td[contenteditable="true"] {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: text;
      caret-color: transparent;
    }
    th[contenteditable="true"]:focus, td[contenteditable="true"]:focus {
      outline: 2px solid #4a90e2;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      caret-color: transparent;
    }
    th[contenteditable="true"]:focus::after, td[contenteditable="true"]:focus::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 1.2em;
      background-color: #000;
    }
    th > *, td > * {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    th {
      background: #dceeff;
      font-weight: bold;
    }
    th:first-child, td:first-child {
      width: 1%;
      white-space: nowrap;
    }
    td[contenteditable], th[contenteditable] {
      cursor: text;
    }
    .selected {
      outline: 2px solid #4a90e2;
    }
    .fullscreen-mode {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      z-index: 9999;
      padding: 20px;
      overflow: auto;
      height: 100vh;
      box-sizing: border-box;
    }
    .fullscreen-mode h2 {
      margin: 10px 20px;
      padding-left: 0;
    }
    .fullscreen-mode .controls {
      background: #eef8ff;
    }
    .fullscreen-mode #editableTable {
      max-width: calc(100% - 40px);
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow-x: auto;
      display: table;
      table-layout: fixed;
      width: 100%;
    }
    .fullscreen-mode #editableTable thead {
      background: #fff;
    }
    .fullscreen-mode #editableTable thead th {
      background: #dceeff;
    }
    .fullscreen-mode #editableTable tbody {
      display: table-row-group;
    }
    .fullscreen-mode #editableTable tr {
      display: table-row;
    }
    .fullscreen-mode #editableTable td,
    .fullscreen-mode #editableTable th {
      display: table-cell;
      white-space: normal;
      word-wrap: break-word;
    }
    #editableTable {
      margin: 0 auto;
      max-width: calc(100% - 40px);
    }
    #editableTable tbody {
      display: table-row-group;
    }
    #editableTable tr {
      display: table-row;
    }
    #editableTable td, #editableTable th {
      display: table-cell;
      align-items: center;
      justify-content: center;
      min-height: 40px;
      height: 100%;
    }
    .style-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .style-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .style-panel .title::before {
      content: "ğŸ¨";
      margin-right: 8px;
    }
    .style-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .style-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .style-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .style-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .style-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .style-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .style-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .style-panel button.apply {
      background: #28a745;
      color: white;
    }
    .style-panel button.close {
      background: #6c757d;
      color: white;
    }
    .style-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .style-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .style-panel .info-content p {
      margin: 5px 0;
    }
    .style-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .style-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .style-panel .preset-sizes {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .style-panel .preset-sizes button {
      padding: 2px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    .style-panel .preset-sizes button:hover {
      background: #dee2e6;
    }
    .style-panel .preset-colors {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .style-panel .preset-colors button {
      width: 20px;
      height: 20px;
      padding: 0;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    tbody tr:nth-child(even) {
      background-color: rgba(220, 220, 220, 0.2);
    }
    .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      margin-top: 5px;
    }
    .group:hover .tooltip {
      display: block;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }
    .align-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .align-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .align-panel .title::before {
      content: "â†”ï¸";
      margin-right: 8px;
    }
    .align-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .align-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .align-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .align-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .align-panel .align-buttons {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .align-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .align-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .align-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .align-panel button.close {
      background: #6c757d;
      color: white;
    }
    .align-panel .align-buttons button {
      justify-content: flex-start;
      padding: 10px 15px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      color: #495057;
    }
    .align-panel .align-buttons button:hover {
      background: #e9ecef;
    }
    .align-panel .align-buttons button .icon {
      font-size: 16px;
      margin-right: 10px;
    }
    .align-panel .align-buttons button .text {
      font-size: 13px;
    }
    .align-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .align-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .align-panel .info-content p {
      margin: 5px 0;
    }
    .align-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .align-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .edit-mode-button {
      position: fixed;
      top: 5px;
      left: 10px;
      padding: 4px 8px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      z-index: 10000;
      display: none;
      transform: scale(0.85);
    }
    .fullscreen-mode .edit-mode-button {
      display: block;
    }
    .mode-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 10001;
      font-size: 14px;
      text-align: center;
      display: none;
    }
    .number-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 250px;
    }
    .number-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .number-panel .title::before {
      content: "ğŸ”¢";
      margin-right: 8px;
    }
    .number-panel .number-group {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #dee2e6;
    }
    .number-panel .number-group:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .number-panel label {
      font-size: 13px;
      color: #495057;
      display: block;
      margin-bottom: 8px;
    }
    .number-panel select, .number-panel input {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      margin-bottom: 8px;
    }
    .number-panel .preset-buttons {
      display: flex;
      gap: 5px;
      margin-top: 5px;
      flex-wrap: wrap;
    }
    .number-panel .preset-buttons button {
      padding: 2px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    .number-panel .preset-buttons button:hover {
      background: #dee2e6;
    }
    .number-panel .unit-group {
      display: flex;
      gap: 10px;
    }
    .number-panel .unit-group input {
      flex: 1;
    }
    .number-panel .multi-input {
      margin-top: 10px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      display: none;
    }
    .number-panel .multi-input.active {
      display: block;
    }
    .number-panel .cell-input {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      padding: 5px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .number-panel .cell-input label {
      margin: 0;
      margin-right: 10px;
      min-width: 60px;
    }
    .number-panel .cell-input input {
      flex: 1;
      margin: 0;
    }
    .number-panel .quick-input {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }
    .number-panel .quick-input button {
      flex: 1;
      padding: 5px;
      font-size: 12px;
    }
    .number-panel button {
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #ced4da;
      background: #e9ecef;
      border-radius: 4px;
      margin: 2px;
      transition: all 0.2s ease;
    }
    .number-panel button:hover {
      background: #dee2e6;
    }
    .number-panel .number-group:last-child button {
      padding: 5px 15px;
      font-size: 14px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .number-panel .number-group:last-child button:last-child {
      background: #6c757d;
    }
    .number-panel .number-group:last-child button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .sum-button-group {
      position: relative;
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .sum-button-group .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      margin-top: 5px;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }
    .sum-button-group:hover .tooltip {
      display: block;
    }
    .hyperlink-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .hyperlink-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .hyperlink-panel .title::before {
      content: "ğŸ”—";
      margin-right: 8px;
    }
    .hyperlink-panel .hyperlink-group {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #dee2e6;
    }
    .hyperlink-panel .hyperlink-list {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
    }
    .hyperlink-panel .hyperlink-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .hyperlink-panel .hyperlink-item input {
      flex: 1;
      padding: 6px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 13px;
    }
    .hyperlink-panel .hyperlink-item .remove-btn {
      padding: 6px 10px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .hyperlink-panel .add-btn {
      width: 100%;
      padding: 8px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    .hyperlink-panel .current-links {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .hyperlink-panel .current-links h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #495057;
    }
    .hyperlink-panel .current-links ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .hyperlink-panel .current-links li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
      font-size: 13px;
      color: #495057;
    }
    .hyperlink-panel .current-links .link-count {
      color: #6c757d;
      font-size: 12px;
    }
    .hyperlink-panel button {
      padding: 8px 15px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .hyperlink-panel button.apply {
      background: #4a90e2;
      color: white;
    }
    .hyperlink-panel button.cancel {
      background: #6c757d;
      color: white;
    }
    .hyperlink-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .table-manipulation-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .table-manipulation-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .table-manipulation-panel .title::before {
      content: "ğŸ“Š";
      margin-right: 8px;
    }
    .table-manipulation-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .table-manipulation-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .table-manipulation-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .table-manipulation-panel .section-title::before {
      margin-right: 8px;
      font-size: 16px;
    }
    .table-manipulation-panel .section.rows .section-title::before {
      content: "â†•ï¸";
    }
    .table-manipulation-panel .section.columns .section-title::before {
      content: "â†”ï¸";
    }
    .table-manipulation-panel .section.headers .section-title::before {
      content: "ğŸ“‘";
    }
    .table-manipulation-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .table-manipulation-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .table-manipulation-panel button.add {
      background: #28a745;
      color: white;
    }
    .table-manipulation-panel button.remove {
      background: #dc3545;
      color: white;
    }
    .table-manipulation-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .table-manipulation-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .table-manipulation-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .sum-row-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .sum-row-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sum-row-panel .title::before {
      content: "ğŸ§®";
      margin-right: 8px;
    }
    .sum-row-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .sum-row-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .sum-row-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .sum-row-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .sum-row-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .sum-row-panel button.add {
      background: #28a745;
      color: white;
    }
    .sum-row-panel button.remove {
      background: #dc3545;
      color: white;
    }
    .sum-row-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .sum-row-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .sum-row-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .sum-row-panel .sum-row-list {
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
    }
    .sum-row-panel .sum-row-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .sum-row-panel .sum-row-item:last-child {
      margin-bottom: 0;
    }
    .sum-row-panel .sum-row-info {
      font-size: 13px;
      color: #495057;
    }
    .sum-row-panel .sum-row-remove {
      padding: 4px 8px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .merge-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .merge-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .merge-panel .title::before {
      content: "ğŸ”—";
      margin-right: 8px;
    }
    .merge-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .merge-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .merge-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .merge-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .merge-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .merge-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .merge-panel button.merge {
      background: #28a745;
      color: white;
    }
    .merge-panel button.undo {
      background: #ffc107;
      color: #000;
    }
    .merge-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .merge-panel button.close {
      background: #6c757d;
      color: white;
    }
    .merge-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .merge-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .merge-panel .info-content p {
      margin: 5px 0;
    }
    .merge-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .merge-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }

    @media print {
      .controls,
      .group,
      .group-title,
      .group button,
      .group .tooltip,
      .style-panel,
      .align-panel,
      .number-panel,
      .hyperlink-panel,
      .table-manipulation-panel,
      .sum-row-panel,
      .merge-panel,
      .edit-mode-button,
      .mode-message {
        display: none !important;
      }

      body {
        margin: 0;
        padding: 20px;
      }

      #editableTable {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
      }

      #editableTable th:first-child,
      #editableTable td:first-child {
        width: auto;
        min-width: auto;
        white-space: nowrap;
      }

      #editableTable th,
      #editableTable td {
        border: 1px solid #aaa;
        padding: 3px;
        text-align: center;
        vertical-align: middle;
        min-height: 24px;
        height: 100%;
        line-height: 1.2;
        white-space: pre-wrap;
        overflow: hidden;
        background-color: inherit !important;
        color: inherit !important;
      }

      #editableTable th {
        background-color: #dceeff !important;
        font-weight: bold;
      }

      #editableTable tbody tr:nth-child(even) {
        background-color: rgba(220, 220, 220, 0.2) !important;
      }

      #editableTable td[style*="background-color: #DAF2D0"] {
        background-color: #DAF2D0 !important;
      }

      #editableTable td[style*="font-weight: bold"] {
        font-weight: bold !important;
      }

      #editableTable td[style*="text-align: right"] {
        text-align: right !important;
      }

      #editableTable td[style*="text-align: left"] {
        text-align: left !important;
      }

      #editableTable td[style*="text-align: center"] {
        text-align: center !important;
      }

      #editableTable td[style*="font-size"] {
        font-size: inherit !important;
      }

      #editableTable td[style*="color"] {
        color: inherit !important;
      }
    }

    .row-height-control {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 4px;
      flex: 1;
      margin-left: 4px;
      position: relative;
    }

    .row-height-control .tooltip {
      display: none;
    }

    .row-height-control:hover .tooltip {
      display: none;
    }

    .row-height-display {
      display: flex;
      align-items: center;
      gap: 2px;
      font-size: 12px;
      color: #333;
      white-space: nowrap;
      min-width: 60px;
    }

    .row-height-display #currentRowHeight {
      font-weight: bold;
      color: #2c5282;
      min-width: 30px;
      text-align: right;
    }

    .row-height-slider {
      flex: 1;
      padding: 0 4px;
    }

    .row-height-slider input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 2px;
      outline: none;
    }

    .row-height-slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #4a90e2;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-slider input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #357abd;
    }

    .row-height-presets {
      display: flex;
      gap: 2px;
      white-space: nowrap;
    }

    .row-height-presets button {
      padding: 2px 4px;
      font-size: 11px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-presets button:hover {
      background: #e0e0e0;
      transform: translateY(-1px);
    }

    .row-height-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }

    .row-height-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .row-height-panel .title::before {
      content: "ğŸ“";
      margin-right: 8px;
    }

    .row-height-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .row-height-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .row-height-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    .row-height-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }

    .row-height-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .row-height-panel button.close {
      background: #6c757d;
      color: white;
    }

    .row-height-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .row-height-panel .row-height-control {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }

    .row-height-panel .row-height-display {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      color: #495057;
    }

    .row-height-panel .row-height-display #currentRowHeight {
      font-weight: bold;
      color: #2c5282;
      min-width: 30px;
      text-align: right;
    }

    .row-height-panel .row-height-slider {
      width: 100%;
    }

    .row-height-panel .row-height-slider input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 2px;
      outline: none;
    }

    .row-height-panel .row-height-slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #4a90e2;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-panel .row-height-slider input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #357abd;
    }

    .row-height-panel .row-height-presets {
      display: flex;
      gap: 4px;
      justify-content: center;
    }

    .row-height-panel .row-height-presets button {
      padding: 4px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }

    .row-height-panel .row-height-presets button:hover {
      background: #dee2e6;
    }
  </style>
</head>
<body>

<div id="controls" class="controls">
  <div class="group">
    <div class="group-title">íŒŒì¼</div>
    <button onclick="downloadHTML()">ë‹¤ìš´ë¡œë“œ</button>
    <div class="tooltip">HTML íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">ì „ì²´í™”ë©´</div>
    <button onclick="toggleFullscreen()">ì „ì²´í™”ë©´</button>
    <div class="tooltip">ì „ì²´í™”ë©´ ëª¨ë“œë¥¼ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">ìŠ¤íƒ€ì¼</div>
    <button onclick="toggleStyleMode()">ìŠ¤íƒ€ì¼ ëª¨ë“œ</button>
    <div class="tooltip">ì…€ì„ ì„ íƒí•˜ì—¬ ê¸€ì í¬ê¸°, êµµê¸°, ìƒ‰ìƒì„ í•œ ë²ˆì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">í•˜ì´í¼ë§í¬</div>
    <button onclick="toggleHyperlinkMode()">í•˜ì´í¼ë§í¬</button>
    <div class="tooltip">í•˜ì´í¼ë§í¬ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">ìˆ«ì ì…ë ¥</div>
    <button onclick="toggleNumberMode()">ìˆ«ì ì…ë ¥ ëª¨ë“œ</button>
    <div class="tooltip">ì…€ì„ ì„ íƒí•˜ì—¬ ìˆ«ì í˜•ì‹ê³¼ ë‹¨ìœ„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">í•©ê³„ í–‰</div>
    <div class="sum-button-group">
      <button onclick="addSumRow()">í•©ê³„ í–‰ ì¶”ê°€</button>
      <button onclick="removeSumRows()">í•©ê³„ í–‰ ì œê±°</button>
      <div class="tooltip">í•©ê³„ í–‰ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="group">
    <div class="group-title">í–‰/ì—´ ì¡°ì‘</div>
    <button onclick="toggleTableManipulation()">í–‰/ì—´ ì¡°ì‘</button>
    <div class="tooltip">í…Œì´ë¸”ì˜ í–‰ê³¼ ì—´ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group" style="min-width: 200px;">
    <div class="group-title">ì—´ í­ ì¡°ì •</div>
    <div style="display: flex; gap: 4px; justify-content: center;">
      <button onclick="autoAdjustColumnWidths()">ì—´ í­ ìë™ ì¡°ì •</button>
      <button onclick="resetColumnWidths()">ì—´ í­ ì´ˆê¸°í™”</button>
    </div>
    <div class="tooltip">í…Œì´ë¸”ì˜ ì—´ í­ì„ ë‚´ìš©ì— ë§ê²Œ ìë™ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">ë³‘í•©</div>
    <button onclick="toggleMergeMode()">ë³‘í•© ëª¨ë“œ</button>
    <div class="tooltip">ì…€ì„ ì„ íƒí•˜ì—¬ ë³‘í•©í•˜ê±°ë‚˜ ë³‘í•©ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë˜ëŒë¦¬ê¸° ìµœëŒ€ 10íšŒ ê°€ëŠ¥)</div>
  </div>
  <div class="group">
    <div class="group-title">ì •ë ¬</div>
    <button onclick="toggleAlignMode()">ì •ë ¬ ëª¨ë“œ</button>
    <div class="tooltip">ì…€ì„ ì„ íƒí•˜ì—¬ ì •ë ¬ ë°©ì‹ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
  <div class="group">
    <div class="group-title">í–‰ ë†’ì´ ì¡°ì •</div>
    <button onclick="toggleRowHeightPanel()">í–‰ ë†’ì´ ì¡°ì •</button>
    <div class="tooltip">í…Œì´ë¸”ì˜ í–‰ ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì •í•˜ê±°ë‚˜ ì§ì ‘ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
</div>

<h2 contenteditable="true">í˜‘ì˜ ì•ˆê±´ ëª©ë¡</h2>

<table id="editableTable">
  <thead>
    <tr>
      <th>NO.</th>
      <th contenteditable="true">í•­ëª©</th>
      <th contenteditable="true">ì—°ê´€ì„±</th>
      <th contenteditable="true">ì˜ˆì‚°</th>
      <th contenteditable="true">ê³„íš</th>
      <th contenteditable="true">ë¹„ìš©(ì˜ˆìƒ)</th>
      <th contenteditable="true">ì§„í–‰</th>
      <th contenteditable="true">ì´ì›”</th>
      <th contenteditable="true">ë¹„ê³ </th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div class="style-panel" id="stylePanel">
  <div class="title">ìŠ¤íƒ€ì¼ ì„¤ì •</div>
  <div class="section style-mode">
    <div class="section-title">ìŠ¤íƒ€ì¼ ëª¨ë“œ</div>
    <div class="button-group">
      <button class="mode" onclick="toggleStyleMode()">ìŠ¤íƒ€ì¼ ëª¨ë“œ í™œì„±í™”</button>
      <button class="cancel" onclick="cancelStyleMode()">ìŠ¤íƒ€ì¼ ëª¨ë“œ ì·¨ì†Œ</button>
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">ê¸€ì í¬ê¸°</div>
    <div class="style-group">
      <input type="number" id="fontSize" min="10" max="40" value="18"> px
      <div class="preset-sizes">
        <button onclick="setFontSize(14)">ì‘ê²Œ</button>
        <button onclick="setFontSize(18)">ë³´í†µ</button>
        <button onclick="setFontSize(24)">í¬ê²Œ</button>
        <button onclick="setFontSize(32)">ë§¤ìš° í¬ê²Œ</button>
      </div>
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">ê¸€ì êµµê¸°</div>
    <div class="style-group">
      <input type="checkbox" id="fontBold"> êµµê²Œ
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">ê¸€ì ìƒ‰ìƒ</div>
    <div class="style-group">
      <input type="color" id="fontColor">
      <div class="preset-colors">
        <button style="background: #000000" onclick="setFontColor('#000000')"></button>
        <button style="background: #ff0000" onclick="setFontColor('#ff0000')"></button>
        <button style="background: #0000ff" onclick="setFontColor('#0000ff')"></button>
        <button style="background: #008000" onclick="setFontColor('#008000')"></button>
      </div>
    </div>
  </div>
  <div class="section style-info">
    <div class="section-title">ìŠ¤íƒ€ì¼ ì •ë³´</div>
    <div class="info-content">
      <p>â€¢ ìŠ¤íƒ€ì¼ ëª¨ë“œì—ì„œ ì…€ì„ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
      <p>â€¢ ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ì„ ì„¤ì •í•˜ê³  "ìŠ¤íƒ€ì¼ ì ìš©" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
      <p>â€¢ ìŠ¤íƒ€ì¼ì„ ì·¨ì†Œí•˜ë ¤ë©´ "ìŠ¤íƒ€ì¼ ëª¨ë“œ ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
      <p>â€¢ ì—¬ëŸ¬ ì…€ì„ ë™ì‹œì— ì„ íƒí•˜ì—¬ í•œ ë²ˆì— ìŠ¤íƒ€ì¼ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
  </div>
  <div class="status">
    í˜„ì¬ ìƒíƒœ: <span id="styleStatus">ëŒ€ê¸°ì¤‘...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="apply" onclick="applyStyle()">ìŠ¤íƒ€ì¼ ì ìš©</button>
    <button class="close" onclick="cancelStyleMode()">ë‹«ê¸°</button>
  </div>
</div>

<div class="align-panel" id="alignPanel">
  <div class="title">ì…€ ì •ë ¬</div>
  <div class="section align-mode">
    <div class="section-title">ì •ë ¬ ëª¨ë“œ</div>
    <div class="button-group">
      <button class="mode" onclick="toggleAlignMode()">ì •ë ¬ ëª¨ë“œ í™œì„±í™”</button>
      <button class="cancel" onclick="cancelAlignMode()">ì •ë ¬ ëª¨ë“œ ì·¨ì†Œ</button>
    </div>
  </div>
  <div class="section align-actions">
    <div class="section-title">ì •ë ¬ ë°©í–¥</div>
    <div class="align-buttons">
      <button class="align-left" onclick="applyAlignment('left')">
        <span class="icon">â¬…ï¸</span>
        <span class="text">ì¢Œì¸¡ ì •ë ¬</span>
      </button>
      <button class="align-center" onclick="applyAlignment('center')">
        <span class="icon">â†”ï¸</span>
        <span class="text">ì¤‘ì•™ ì •ë ¬</span>
      </button>
      <button class="align-right" onclick="applyAlignment('right')">
        <span class="icon">â¡ï¸</span>
        <span class="text">ìš°ì¸¡ ì •ë ¬</span>
      </button>
    </div>
  </div>
  <div class="section align-info">
    <div class="section-title">ì •ë ¬ ì •ë³´</div>
    <div class="info-content">
      <p>â€¢ ì •ë ¬ ëª¨ë“œì—ì„œ ì…€ì„ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
      <p>â€¢ ì›í•˜ëŠ” ì •ë ¬ ë°©í–¥ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì •ë ¬ì„ ì ìš©í•˜ì„¸ìš”.</p>
      <p>â€¢ ì •ë ¬ì„ ì·¨ì†Œí•˜ë ¤ë©´ "ì •ë ¬ ëª¨ë“œ ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
      <p>â€¢ ì—¬ëŸ¬ ì…€ì„ ë™ì‹œì— ì„ íƒí•˜ì—¬ í•œ ë²ˆì— ì •ë ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
  </div>
  <div class="status">
    í˜„ì¬ ìƒíƒœ: <span id="alignStatus">ëŒ€ê¸°ì¤‘...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelAlignMode()">ë‹«ê¸°</button>
  </div>
</div>

<div class="edit-mode-button" onclick="toggleFullscreen()">í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜</div>
<div id="modeMessage" class="mode-message"></div>

<div class="number-panel" id="numberPanel">
  <div class="title">ìˆ«ì ì…ë ¥ ì„¤ì •</div>
  <div class="number-group">
    <label>ì…ë ¥ í˜•ì‹</label>
    <select id="numberFormat">
      <option value="thousand" selected>ì²œ ë‹¨ìœ„ êµ¬ë¶„</option>
      <option value="number">ì¼ë°˜ ìˆ«ì</option>
      <option value="currency">í†µí™” í˜•ì‹</option>
      <option value="percent">ë°±ë¶„ìœ¨</option>
      <option value="decimal">ì†Œìˆ˜ì </option>
    </select>
  </div>
  <div class="number-group">
    <label>ë‹¨ìœ„ ë³€í™˜</label>
    <select id="unitType">
      <option value="accounting" selected>íšŒê³„ ë‹¨ìœ„</option>
      <option value="none">ë‹¨ìœ„ ì—†ìŒ</option>
      <option value="currency">ê¸ˆì•¡ ë‹¨ìœ„</option>
      <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
    </select>
    <div class="unit-group">
      <input type="text" id="unitPrefix" placeholder="ì ‘ë‘ì–´">
      <input type="text" id="unitSuffix" placeholder="ì ‘ë¯¸ì–´">
    </div>
  </div>
  <div class="number-group">
    <label>ìì£¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ìœ„</label>
    <div class="preset-buttons">
      <button onclick="setUnit('ì›')">ì›</button>
      <button onclick="setUnit('ì²œì›')">ì²œì›</button>
      <button onclick="setUnit('ë§Œì›')">ë§Œì›</button>
      <button onclick="setUnit('ë°±ë§Œì›')">ë°±ë§Œì›</button>
      <button onclick="setUnit('ì–µì›')">ì–µì›</button>
      <button onclick="setUnit('ê°œ')">ê°œ</button>
      <button onclick="setUnit('SET')">SET</button>
      <button onclick="setUnit('BOX')">BOX</button>
    </div>
  </div>
  <div class="number-group">
    <label>ë‹¤ì¤‘ ì…€ ì…ë ¥</label>
    <div class="multi-input" id="multiInput">
      <div id="cellInputs"></div>
      <div class="quick-input">
        <button onclick="applySameValue()">ëª¨ë‘ ê°™ì€ ê°’</button>
        <button onclick="applySequence()">ìˆœì°¨ ì¦ê°€</button>
        <button onclick="applyRandom()">ëœë¤ ê°’</button>
      </div>
    </div>
  </div>
  <div class="number-group" style="margin-top: 15px; text-align: center; border-top: 1px solid #dee2e6; padding-top: 15px;">
    <button onclick="applyNumberFormat()" style="margin-right: 5px; padding: 5px 15px; font-size: 14px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">ì ìš©</button>
    <button onclick="cancelNumberMode()" style="padding: 5px 15px; font-size: 14px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ì·¨ì†Œ</button>
  </div>
</div>

<div class="hyperlink-panel" id="hyperlinkPanel">
  <div class="title">í•˜ì´í¼ë§í¬ ì„¤ì •</div>
  <div class="hyperlink-group">
    <div class="hyperlink-list" id="hyperlinkList">
      <div class="hyperlink-item">
        <input type="text" class="search-input" placeholder="ê²€ìƒ‰ì–´ (ì •ê·œì‹)">
        <input type="text" class="url-input" placeholder="URL">
        <button class="remove-btn" onclick="removeHyperlinkItem(this)">Ã—</button>
      </div>
    </div>
    <button class="add-btn" onclick="addHyperlinkItem()">+ ê²€ìƒ‰ì–´/URL ì¶”ê°€</button>
    <div class="current-links">
      <h4>í˜„ì¬ ì ìš©ëœ í•˜ì´í¼ë§í¬</h4>
      <ul id="currentLinksList"></ul>
    </div>
  </div>
  <div class="button-group">
    <button class="apply" onclick="applyHyperlinks()">ì ìš©</button>
    <button class="cancel" onclick="cancelHyperlinkMode()">ì·¨ì†Œ</button>
  </div>
</div>

<div class="table-manipulation-panel" id="tableManipulationPanel">
  <div class="title">í…Œì´ë¸” ì¡°ì‘</div>
  <div class="section rows">
    <div class="section-title">í–‰ ì¡°ì‘</div>
    <div class="button-group">
      <button class="add" onclick="addRow()">ì…ë ¥ í–‰ ì¶”ê°€</button>
      <button class="remove" onclick="deleteRow()">ì…ë ¥ í–‰ ì‚­ì œ</button>
    </div>
  </div>
  <div class="section headers">
    <div class="section-title">ì œëª© í–‰ ì¡°ì‘</div>
    <div class="button-group">
      <button class="add" onclick="addHeader()">ì œëª© í–‰ ì¶”ê°€</button>
      <button class="remove" onclick="deleteHeader()">ì œëª© í–‰ ì‚­ì œ</button>
    </div>
  </div>
  <div class="section columns">
    <div class="section-title">ì—´ ì¡°ì‘</div>
    <div class="button-group">
      <button class="add" onclick="addColumn()">ì—´ ì¶”ê°€</button>
      <button class="remove" onclick="deleteColumn()">ì—´ ì‚­ì œ</button>
    </div>
  </div>
  <div class="status">
    í˜„ì¬ ìƒíƒœ: <span id="tableStatus">ë¡œë”©ì¤‘...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="cancel" onclick="cancelTableManipulation()">ë‹«ê¸°</button>
  </div>
</div>

<div class="sum-row-panel" id="sumRowPanel">
  <div class="title">í•©ê³„ í–‰ ê´€ë¦¬</div>
  <div class="sum-row-list">
    <!-- í•©ê³„ í–‰ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì • -->
  </div>
  <div class="button-group">
    <button class="add" onclick="addSumRow()">í•©ê³„ í–‰ ì¶”ê°€</button>
    <button class="remove" onclick="removeSumRows()">í•©ê³„ í–‰ ì œê±°</button>
  </div>
</div>

<div class="merge-panel" id="mergePanel">
  <div class="title">ì…€ ë³‘í•©</div>
  <div class="section merge-mode">
    <div class="section-title">ë³‘í•© ëª¨ë“œ</div>
    <div class="button-group">
      <button class="mode" onclick="toggleMergeMode()">ë³‘í•© ëª¨ë“œ í™œì„±í™”</button>
      <button class="cancel" onclick="cancelMergeMode()">ë³‘í•© ëª¨ë“œ ì·¨ì†Œ</button>
    </div>
  </div>
  <div class="section merge-actions">
    <div class="section-title">ë³‘í•© ì‘ì—…</div>
    <div class="button-group">
      <button class="merge" onclick="mergeCells()">ì„ íƒ ì…€ ë³‘í•©</button>
      <button class="undo" onclick="undoMerge()">ë³‘í•© ë˜ëŒë¦¬ê¸°</button>
    </div>
  </div>
  <div class="section merge-info">
    <div class="section-title">ë³‘í•© ì •ë³´</div>
    <div class="info-content">
      <p>â€¢ ë³‘í•© ëª¨ë“œì—ì„œ ì…€ì„ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
      <p>â€¢ ì„ íƒí•œ ì…€ë“¤ì„ ë³‘í•©í•˜ë ¤ë©´ "ì„ íƒ ì…€ ë³‘í•©" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
      <p>â€¢ ë³‘í•©ì„ ì·¨ì†Œí•˜ë ¤ë©´ "ë³‘í•© ëª¨ë“œ ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
      <p>â€¢ ë§ˆì§€ë§‰ ë³‘í•©ì„ ë˜ëŒë¦¬ë ¤ë©´ "ë³‘í•© ë˜ëŒë¦¬ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
    </div>
  </div>
  <div class="status">
    í˜„ì¬ ìƒíƒœ: <span id="mergeStatus">ëŒ€ê¸°ì¤‘...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelMergeMode()">ë‹«ê¸°</button>
  </div>
</div>

<div class="row-height-panel" id="rowHeightPanel">
  <div class="title">í–‰ ë†’ì´ ì¡°ì •</div>
  <div class="section">
    <div class="section-title">ìë™ ì¡°ì •</div>
    <div class="button-group">
      <button onclick="autoAdjustRowHeights()">í–‰ ë†’ì´ ìë™ ì¡°ì •</button>
      <button onclick="resetRowHeights()">í–‰ ë†’ì´ ì´ˆê¸°í™”</button>
    </div>
  </div>
  <div class="section">
    <div class="section-title">ìˆ˜ë™ ì¡°ì •</div>
    <div class="row-height-control">
      <div class="row-height-display">
        <span>ë†’ì´: </span>
        <span id="currentRowHeight">24</span>
        <span>px</span>
      </div>
      <div class="row-height-slider">
        <input type="range" id="rowHeightSlider" min="24" max="200" value="24" step="1">
      </div>
      <div class="row-height-presets">
        <button onclick="setRowHeight(24)">ì‘ê²Œ</button>
        <button onclick="setRowHeight(32)">ë³´í†µ</button>
        <button onclick="setRowHeight(48)">í¬ê²Œ</button>
        <button onclick="setRowHeight(64)">ë§¤ìš° í¬ê²Œ</button>
      </div>
    </div>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelRowHeightPanel()">ë‹«ê¸°</button>
  </div>
</div>

<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨ì„ 112%ë¡œ ì„¤ì •
window.addEventListener('load', function() {
  document.body.style.zoom = "112%";
});

let undoStack = [];
let mergeMode = false;
let isSelecting = false;
let selectedCell = null;
let alignMode = false;
let styleMode = false;
let numberMode = false;

function saveState() {
  undoStack.push(document.getElementById('editableTable').innerHTML);
  if (undoStack.length > 10) undoStack.shift();
}

function undoMerge() {
  if (!undoStack.length) return alert('ë˜ëŒë¦´ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.');
  document.getElementById('editableTable').innerHTML = undoStack.pop();
  initSelectable();
}

function addRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  const rowCount = tbody.rows.length + 1;
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${rowCount}</td>` + '<td contenteditable="true"></td>'.repeat(8);
  tbody.appendChild(tr);
  initSelectable();
  updateTableStatus();
}

function deleteRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  if (tbody.rows.length > 1) {
    tbody.deleteRow(-1);
    updateTableStatus();
  }
}

function addHeader() {
  saveState();
  const tr = document.createElement('tr');
  for (let i = 0; i < 9; i++) {
    const th = document.createElement('th');
    th.contentEditable = 'true';
    th.style.background = '#dceeff';
    tr.appendChild(th);
  }
  document.querySelector('#editableTable thead').appendChild(tr);
  updateTableStatus();
}

function deleteHeader() {
  saveState();
  const thead = document.querySelector('#editableTable thead');
  if (thead.rows.length > 1) {
    thead.deleteRow(-1);
    updateTableStatus();
  }
}

function addColumn() {
  saveState();
  document.querySelectorAll('#editableTable tr').forEach(row => {
    const cell = row.insertCell(-1);
    cell.contentEditable = 'true';
    if (row.parentElement.tagName === 'THEAD') {
      cell.style.background = '#dceeff';
    }
  });
  initSelectable();
  updateTableStatus();
}

function deleteColumn() {
  saveState();
  document.querySelectorAll('#editableTable tr').forEach(row => {
    if (row.cells.length > 1) row.deleteCell(-1);
  });
  initSelectable();
  updateTableStatus();
}

function showModeMessage(message) {
  const messageBox = document.getElementById('modeMessage');
  messageBox.textContent = message;
  messageBox.style.display = 'block';
  setTimeout(() => {
    messageBox.style.display = 'none';
  }, 3000);
}

function toggleMergeMode() {
  mergeMode = true;
  alignMode = false;
  styleMode = false;
  clearSelection();
  document.getElementById('alignPanel').style.display = 'none';
  document.getElementById('stylePanel').style.display = 'none';
  
  // ë³‘í•© íŒ¨ë„ í‘œì‹œ
  const mergePanel = document.getElementById('mergePanel');
  mergePanel.style.display = 'block';
  initMergePanelDrag();
  updateMergeStatus('ë³‘í•© ëª¨ë“œ í™œì„±í™” - ì…€ì„ ì„ íƒí•˜ì„¸ìš”');
  
  showModeMessage('ë³‘í•© ëª¨ë“œ í™œì„±í™”\nì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ì…€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
}

function cancelMergeMode() {
  mergeMode = false;
  clearSelection();
  const mergePanel = document.getElementById('mergePanel');
  mergePanel.style.display = 'none';
  mergePanel.style.transform = 'translate(0, 0)';
  updateMergeStatus('ëŒ€ê¸°ì¤‘...');
}

function initMergePanelDrag() {
  const mergePanel = document.getElementById('mergePanel');
  const title = mergePanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, mergePanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateMergeStatus(message) {
  const status = document.getElementById('mergeStatus');
  status.textContent = message;
}

function mergeCells() {
  if (!mergeMode) {
    updateMergeStatus('ë³‘í•© ëª¨ë“œë¥¼ ë¨¼ì € í™œì„±í™”í•˜ì„¸ìš”');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length < 2) {
    updateMergeStatus('ë³‘í•©í•  ì…€ì„ 2ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  saveState();
  const table = document.getElementById('editableTable');
  const rows = selected.map(c => c.parentElement.rowIndex);
  const cols = selected.map(c => c.cellIndex);
  const r1 = Math.min(...rows), r2 = Math.max(...rows);
  const c1 = Math.min(...cols), c2 = Math.max(...cols);
  
  // ë³‘í•© ì‘ì—… ìˆ˜í–‰
  const master = table.rows[r1].cells[c1];
  let combined = master.innerHTML;
  for (let i = r1; i <= r2; i++) {
    for (let j = c1; j <= c2; j++) {
      if (i === r1 && j === c1) continue;
      combined += '<br>' + table.rows[i].cells[j]?.innerHTML;
    }
  }
  
  // ë³‘í•© ì ìš©
  master.innerHTML = combined;
  master.rowSpan = r2 - r1 + 1;
  master.colSpan = c2 - c1 + 1;
  
  // ìŠ¤íƒ€ì¼ ì ìš©
  master.style.height = 'auto';
  master.style.minHeight = '40px';
  master.style.whiteSpace = 'pre-wrap';
  master.style.verticalAlign = 'middle';
  
  // ë†’ì´ ìë™ ì¡°ì •
  const contentHeight = master.scrollHeight;
  if (contentHeight > 40) {
    master.style.height = contentHeight + 'px';
  }
  
  // í¸ì§‘ ê°€ëŠ¥ ì„¤ì •
  master.contentEditable = 'true';
  
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  master.onmousedown = e => {
    if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
    e.preventDefault();
    if (!isSelecting) {
      saveState();
      isSelecting = true;
    }
    master.classList.add('selected');
    if (numberMode) {
      updateMultiInput();
    }
  };
  
  master.onmouseover = e => {
    if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
      e.target.classList.add('selected');
      if (numberMode) {
        updateMultiInput();
      }
    }
  };
  
  master.onmouseup = () => {
    isSelecting = false;
  };
  
  // ë‚´ìš© ë³€ê²½ ì‹œ ë†’ì´ ìë™ ì¡°ì •
  master.addEventListener('input', function() {
    this.style.height = 'auto';
    const newHeight = this.scrollHeight;
    if (newHeight > 40) {
      this.style.height = newHeight + 'px';
    }
    
    const rowSpan = parseInt(this.getAttribute('rowspan')) || 1;
    const rowHeight = Math.ceil(newHeight / rowSpan);
    for (let i = 0; i < rowSpan; i++) {
      const row = table.rows[r1 + i];
      if (row) {
        row.style.height = rowHeight + 'px';
      }
    }
  });
  
  // ë³‘í•©ëœ ì…€ ì œê±°
  for (let i = r2; i >= r1; i--) {
    for (let j = c2; j >= c1; j--) {
      if (i === r1 && j === c1) continue;
      table.rows[i].deleteCell(j);
    }
  }
  
  mergeMode = false;
  clearSelection();
  updateMergeStatus('ì…€ ë³‘í•© ì™„ë£Œ');
  
  // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
  setTimeout(() => {
    updateMergeStatus('ëŒ€ê¸°ì¤‘...');
  }, 3000);
}

function toggleAlignMode() {
  alignMode = true;
  mergeMode = false;
  styleMode = false;
  clearSelection();
  const alignPanel = document.getElementById('alignPanel');
  alignPanel.style.display = 'block';
  initAlignPanelDrag();
  updateAlignStatus('ì •ë ¬ ëª¨ë“œ í™œì„±í™” - ì…€ì„ ì„ íƒí•˜ì„¸ìš”');
  showModeMessage('ì •ë ¬ ëª¨ë“œ í™œì„±í™”\nì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ì…€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
}

function cancelAlignMode() {
  alignMode = false;
  clearSelection();
  const alignPanel = document.getElementById('alignPanel');
  alignPanel.style.display = 'none';
  alignPanel.style.transform = 'translate(0, 0)';
  updateAlignStatus('ëŒ€ê¸°ì¤‘...');
}

function initAlignPanelDrag() {
  const alignPanel = document.getElementById('alignPanel');
  const title = alignPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, alignPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateAlignStatus(message) {
  const status = document.getElementById('alignStatus');
  status.textContent = message;
}

function applyAlignment(align) {
  if (!alignMode) {
    updateAlignStatus('ì •ë ¬ ëª¨ë“œë¥¼ ë¨¼ì € í™œì„±í™”í•˜ì„¸ìš”');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) {
    updateAlignStatus('ì •ë ¬í•  ì…€ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  selected.forEach(cell => cell.style.textAlign = align);
  alignMode = false;
  clearSelection();
  updateAlignStatus('ì •ë ¬ ì ìš© ì™„ë£Œ');
  
  // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
  setTimeout(() => {
    updateAlignStatus('ëŒ€ê¸°ì¤‘...');
  }, 3000);
}

function toggleStyleMode() {
  styleMode = true;
  mergeMode = false;
  alignMode = false;
  clearSelection();
  const stylePanel = document.getElementById('stylePanel');
  stylePanel.style.display = 'block';
  initStylePanelDrag();
  updateStyleStatus('ìŠ¤íƒ€ì¼ ëª¨ë“œ í™œì„±í™” - ì…€ì„ ì„ íƒí•˜ì„¸ìš”');
  showModeMessage('ìŠ¤íƒ€ì¼ ëª¨ë“œ í™œì„±í™”\nì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ì…€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
}

function cancelStyleMode() {
  styleMode = false;
  clearSelection();
  const stylePanel = document.getElementById('stylePanel');
  stylePanel.style.display = 'none';
  stylePanel.style.transform = 'translate(0, 0)';
  updateStyleStatus('ëŒ€ê¸°ì¤‘...');
}

function initStylePanelDrag() {
  const stylePanel = document.getElementById('stylePanel');
  const title = stylePanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;

    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;

      xOffset = currentX;
      yOffset = currentY;

      setTranslate(currentX, currentY, stylePanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateStyleStatus(message) {
  const status = document.getElementById('styleStatus');
  status.textContent = message;
}

function applyStyle() {
  if (!styleMode) {
    updateStyleStatus('ìŠ¤íƒ€ì¼ ëª¨ë“œë¥¼ ë¨¼ì € í™œì„±í™”í•˜ì„¸ìš”');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) {
    updateStyleStatus('ìŠ¤íƒ€ì¼ì„ ì ìš©í•  ì…€ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  const fontSize = document.getElementById('fontSize').value;
  const isBold = document.getElementById('fontBold').checked;
  const fontColor = document.getElementById('fontColor').value;
  
  selected.forEach(cell => {
    cell.style.fontSize = fontSize + 'px';
    cell.style.fontWeight = isBold ? 'bold' : 'normal';
    cell.style.color = fontColor;
  });
  
  styleMode = false;
  clearSelection();
  updateStyleStatus('ìŠ¤íƒ€ì¼ ì ìš© ì™„ë£Œ');
  
  // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
  setTimeout(() => {
    updateStyleStatus('ëŒ€ê¸°ì¤‘...');
  }, 3000);
}

function initSelectable() {
  clearSelection();
  document.querySelectorAll('#editableTable td, #editableTable th').forEach(cell => {
    // ì´ë¯¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ìˆëŠ” ê²½ìš° ì œê±°
    const newCell = cell.cloneNode(true);
    cell.parentNode.replaceChild(newCell, cell);
    
    // contentEditable ì†ì„±ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ input ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    if (newCell.contentEditable === 'true') {
      newCell.addEventListener('input', function() {
        adjustCellHeight(this);
      });
    }
    
    newCell.onmousedown = e => {
      if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
      e.preventDefault();
      if (!isSelecting) {
        saveState();
        isSelecting = true;
      }
      newCell.classList.add('selected');
      if (numberMode) {
        updateMultiInput();
      }
    };
    newCell.onmouseover = e => {
      if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
        e.target.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      }
    };
    newCell.onmouseup = () => {
      isSelecting = false;
    };
  });
  document.body.onmouseup = () => (isSelecting = false);
}

function clearSelection() {
  document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
}

function toggleHyperlinkMode() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  hyperlinkPanel.style.display = 'block';
  initHyperlinkPanelDrag();
  updateCurrentLinksList(); // í˜„ì¬ ë§í¬ ìƒíƒœ ì—…ë°ì´íŠ¸
}

function cancelHyperlinkMode() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  hyperlinkPanel.style.display = 'none';
  hyperlinkPanel.style.transform = 'translate(0, 0)';
}

function initHyperlinkPanelDrag() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  const title = hyperlinkPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, hyperlinkPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function addHyperlinkItem() {
  const list = document.getElementById('hyperlinkList');
  const item = document.createElement('div');
  item.className = 'hyperlink-item';
  item.innerHTML = `
    <input type="text" class="search-input" placeholder="ê²€ìƒ‰ì–´ (ì •ê·œì‹)">
    <input type="text" class="url-input" placeholder="URL">
    <button class="remove-btn" onclick="removeHyperlinkItem(this)">Ã—</button>
  `;
  list.appendChild(item);
}

function removeHyperlinkItem(button) {
  const item = button.parentElement;
  if (document.querySelectorAll('.hyperlink-item').length > 1) {
    item.remove();
  } else {
    // ë§ˆì§€ë§‰ í•­ëª©ì€ ë¹„ìš°ê¸°ë§Œ í•¨
    item.querySelectorAll('input').forEach(input => input.value = '');
  }
}

function updateCurrentLinksList() {
  const list = document.getElementById('currentLinksList');
  list.innerHTML = '';
  
  // í˜„ì¬ í…Œì´ë¸”ì˜ ëª¨ë“  í•˜ì´í¼ë§í¬ ìˆ˜ì§‘
  const linkMap = new Map();
  document.querySelectorAll('#editableTable a').forEach(a => {
    const url = a.href;
    const text = a.textContent;
    if (!linkMap.has(url)) {
      linkMap.set(url, new Set());
    }
    linkMap.get(url).add(text);
  });
  
  // ë§í¬ ëª©ë¡ í‘œì‹œ
  linkMap.forEach((texts, url) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${url}</span>
      <span class="link-count">(${texts.size}ê°œ í…ìŠ¤íŠ¸)</span>
    `;
    list.appendChild(li);
  });
  
  if (linkMap.size === 0) {
    const li = document.createElement('li');
    li.textContent = 'ì ìš©ëœ í•˜ì´í¼ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.';
    list.appendChild(li);
  }
}

function applyHyperlinks() {
  const items = document.querySelectorAll('.hyperlink-item');
  const validItems = [];
  
  // ìœ íš¨í•œ ì…ë ¥ í•­ëª© ìˆ˜ì§‘
  items.forEach(item => {
    const searchInput = item.querySelector('.search-input');
    const urlInput = item.querySelector('.url-input');
    const pattern = searchInput.value.trim();
    const url = urlInput.value.trim();
    
    if (pattern && url) {
      try {
        new RegExp(pattern); // ì •ê·œì‹ ê²€ì¦
        validItems.push({ pattern, url });
      } catch (e) {
        alert(`ìœ íš¨í•˜ì§€ ì•Šì€ ì •ê·œì‹ì…ë‹ˆë‹¤: ${pattern}`);
        return;
      }
    }
  });
  
  if (validItems.length === 0) {
    alert('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ê²€ìƒ‰ì–´ì™€ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  const targetCells = selected.length > 0 ? selected : document.querySelectorAll('#editableTable tbody td');
  
  targetCells.forEach(td => {
    let content = td.innerHTML;
    validItems.forEach(({ pattern, url }) => {
      try {
        const regex = new RegExp(pattern, 'g');
        content = content.replace(regex, match => 
          `<a href="${url}" target="_blank" contenteditable="false">${match}</a>`
        );
      } catch (e) {
        console.error(`ì •ê·œì‹ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${pattern}`, e);
      }
    });
    td.innerHTML = content;
  });
  
  updateCurrentLinksList(); // ë§í¬ ìƒíƒœ ì—…ë°ì´íŠ¸
  cancelHyperlinkMode();
}

async function downloadHTML() {
  try {
    // í˜„ì¬ í…Œì´ë¸” ìƒíƒœ ë³µì œ
    const tableClone = document.getElementById('editableTable').cloneNode(true);
    
    // NO. ì—´ì˜ ë„ˆë¹„ ìë™ ì¡°ì •
    const noColumn = tableClone.querySelector('th:first-child');
    if (noColumn) {
      noColumn.style.width = 'auto';
      noColumn.style.minWidth = 'auto';
      noColumn.style.whiteSpace = 'nowrap';
    }
    
    // ëª¨ë“  ì…€ì˜ í˜„ì¬ ìƒíƒœ ë³´ì¡´
    const cells = tableClone.querySelectorAll('td, th');
    cells.forEach(cell => {
      // ìŠ¤íƒ€ì¼ ì •ë³´ ë³´ì¡´
      const computedStyle = window.getComputedStyle(cell);
      cell.style.cssText = computedStyle.cssText;
      
      // ë°ì´í„° ì†ì„± ë³´ì¡´
      const dataAttributes = cell.attributes;
      for (let i = 0; i < dataAttributes.length; i++) {
        const attr = dataAttributes[i];
        if (attr.name.startsWith('data-')) {
          cell.setAttribute(attr.name, attr.value);
        }
      }
      
      // ë³‘í•© ìƒíƒœ ë³´ì¡´
      if (cell.hasAttribute('rowspan')) {
        cell.setAttribute('rowspan', cell.getAttribute('rowspan'));
      }
      if (cell.hasAttribute('colspan')) {
        cell.setAttribute('colspan', cell.getAttribute('colspan'));
      }
      
      // contentEditable ì†ì„± ì œê±°
      cell.removeAttribute('contenteditable');
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      cell.onmousedown = null;
      cell.onmouseover = null;
      cell.onmouseup = null;
      
      // í•˜ì´í¼ë§í¬ ë³´ì¡´
      const links = cell.querySelectorAll('a');
      links.forEach(link => {
        link.removeAttribute('contenteditable');
        link.style.pointerEvents = 'auto';
      });
    });

    // HTML ìƒì„±
    const html = '<!DOCTYPE html>' + document.documentElement.outerHTML;
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    
    // ì›ë³¸ í…Œì´ë¸”ì„ ìˆ˜ì •ëœ í…Œì´ë¸”ë¡œ êµì²´
    const originalTable = tempDiv.querySelector('#editableTable');
    originalTable.parentNode.replaceChild(tableClone, originalTable);
    
    // ì»¨íŠ¸ë¡¤ íŒ¨ë„ ë° ë¶ˆí•„ìš”í•œ ìš”ì†Œ ì œê±°
    const elementsToRemove = [
      '.controls',
      '.style-panel',
      '.align-panel',
      '.number-panel',
      '.hyperlink-panel',
      '.table-manipulation-panel',
      '.sum-row-panel',
      '.merge-panel',
      '.edit-mode-button',
      '.mode-message'
    ];
    
    elementsToRemove.forEach(selector => {
      const element = tempDiv.querySelector(selector);
      if (element) element.remove();
    });
    
    // í…Œì´ë¸” ìŠ¤íƒ€ì¼ ìµœì í™”
    const table = tempDiv.querySelector('#editableTable');
    if (table) {
      table.style.width = '100%';
      table.style.margin = '0 auto';
      table.style.borderCollapse = 'collapse';
      table.style.tableLayout = 'auto';
    }
    
    const finalHtml = '<!DOCTYPE html>' + tempDiv.innerHTML;
    const blob = new Blob(['ï»¿' + finalHtml], { type: 'text/html' });
    
    // í˜„ì¬ ë‚ ì§œë¥¼ YYMMDD í˜•ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
    const now = new Date();
    const year = now.getFullYear().toString().slice(-2);
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    const dateStr = `${year}${month}${day}`;
    
    // íŒŒì¼ëª… ìƒì„±
    const defaultFileName = `í˜‘ì˜_ì•ˆê±´_ëª©ë¡_${dateStr}.html`;

    // íŒŒì¼ ì €ì¥ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
    const handle = await window.showSaveFilePicker({
      suggestedName: defaultFileName,
      types: [{
        description: 'HTML íŒŒì¼',
        accept: {'text/html': ['.html']},
      }],
    });

    // íŒŒì¼ ì €ì¥
    const writable = await handle.createWritable();
    await writable.write(blob);
    await writable.close();

    alert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch (err) {
    if (err.name !== 'AbortError') {
      console.error('íŒŒì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', err);
      alert('íŒŒì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  }
}

function toggleFullscreen() {
  document.body.classList.toggle('fullscreen-mode');
}

function setFontSize(size) {
  document.getElementById('fontSize').value = size;
  if (selectedCell && styleMode) {
    selectedCell.style.fontSize = size + 'px';
  }
}

function setFontColor(color) {
  document.getElementById('fontColor').value = color;
  if (selectedCell && styleMode) {
    selectedCell.style.color = color;
  }
}

function toggleNumberMode() {
  numberMode = true;
  mergeMode = false;
  alignMode = false;
  styleMode = false;
  clearSelection();
  const numberPanel = document.getElementById('numberPanel');
  numberPanel.style.display = 'block';
  document.getElementById('alignPanel').style.display = 'none';
  document.getElementById('stylePanel').style.display = 'none';
  showModeMessage('ìˆ«ì ì…ë ¥ ëª¨ë“œ í™œì„±í™”\nì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ì…€ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  initNumberPanelDrag();
}

function cancelNumberMode() {
  numberMode = false;
  clearSelection();
  const numberPanel = document.getElementById('numberPanel');
  numberPanel.style.display = 'none';
  numberPanel.style.transform = 'translate(0, 0)';
}

function initNumberPanelDrag() {
  const numberPanel = document.getElementById('numberPanel');
  const title = numberPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, numberPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function setUnit(unit) {
  document.getElementById('unitSuffix').value = unit;
}

function updateMultiInput() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  const multiInput = document.getElementById('multiInput');
  const cellInputs = document.getElementById('cellInputs');
  
  if (selected.length > 1) {
    multiInput.classList.add('active');
    cellInputs.innerHTML = '';
    
    selected.forEach((cell, index) => {
      const cellInput = document.createElement('div');
      cellInput.className = 'cell-input';
      
      // í˜„ì¬ ì…€ì˜ ê°’ì„ ê°€ì ¸ì˜´
      let currentValue = cell.textContent.trim();
      // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±° (ë‹¨ìœ„ ë“±)
      currentValue = currentValue.replace(/[^0-9.-]/g, '');
      // ìˆ«ìë¡œ ë³€í™˜
      let numValue = parseFloat(currentValue);
      if (isNaN(numValue)) {
        numValue = 0;
      }
      
      cellInput.innerHTML = `
        <label>ì…€ ${index + 1}</label>
        <input type="number" 
               data-cell-index="${index}" 
               value="${numValue}" 
               onchange="updateCellValue(this)">
      `;
      cellInputs.appendChild(cellInput);
    });
  } else {
    multiInput.classList.remove('active');
  }
}

function updateCellValue(input) {
  const selected = Array.from(document.querySelectorAll('.selected'));
  const index = parseInt(input.dataset.cellIndex);
  if (selected[index]) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    // ì…ë ¥ê°’ì„ ìˆ«ìë¡œ ë³€í™˜
    let numValue = parseFloat(input.value);
    if (isNaN(numValue)) {
      numValue = 0;
    }
    
    // í˜•ì‹ ì ìš©
    selected[index].textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    selected[index].style.textAlign = 'right';
  }
}

function applySameValue() {
  const value = prompt('ëª¨ë“  ì…€ì— ì ìš©í•  ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:');
  if (value === null) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  // ì…ë ¥ê°’ì„ ìˆ«ìë¡œ ë³€í™˜
  let numValue = parseFloat(value);
  if (isNaN(numValue)) {
    numValue = 0;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach(cell => {
    cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function applySequence() {
  const start = parseInt(prompt('ì‹œì‘ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:'));
  if (isNaN(start)) return;
  
  const step = parseInt(prompt('ì¦ê°€ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:'));
  if (isNaN(step)) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach((cell, index) => {
    const value = start + (index * step);
    cell.textContent = formatNumber(value, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function applyRandom() {
  const min = parseInt(prompt('ìµœì†Œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:'));
  if (isNaN(min)) return;
  
  const max = parseInt(prompt('ìµœëŒ€ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”:'));
  if (isNaN(max)) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach(cell => {
    const value = Math.floor(Math.random() * (max - min + 1)) + min;
    cell.textContent = formatNumber(value, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function formatNumber(value, format, unitType, prefix, suffix) {
  if (!value && value !== 0) return '';
  
  let num = parseFloat(value);
  if (isNaN(num)) return value;

  let formattedNum;
  switch (format) {
    case 'thousand':
      formattedNum = num.toLocaleString('ko-KR');
      break;
    case 'currency':
      formattedNum = num.toLocaleString('ko-KR', {
        style: 'currency',
        currency: 'KRW',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      });
      break;
    case 'percent':
      formattedNum = (num * 100).toLocaleString('ko-KR') + '%';
      break;
    case 'decimal':
      formattedNum = num.toLocaleString('ko-KR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
      break;
    default:
      formattedNum = num.toLocaleString('ko-KR');
  }

  // ë‹¨ìœ„ íƒ€ì…ì— ë”°ë¥¸ ì¶”ê°€ í¬ë§·íŒ…
  if (unitType === 'accounting') {
    if (suffix) {
      formattedNum = formattedNum.replace(/[^0-9,]/g, '') + suffix;
    }
  } else if (unitType === 'currency') {
    if (prefix) {
      formattedNum = prefix + formattedNum.replace(/[^0-9,]/g, '');
    }
    if (suffix) {
      formattedNum = formattedNum + suffix;
    }
  }

  return formattedNum;
}

function applyNumberFormat() {
  if (!numberMode) return alert('ìˆ«ì ì…ë ¥ ëª¨ë“œë¥¼ í™œì„±í™”í•˜ì„¸ìš”.');
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) return alert('ìˆ«ì í˜•ì‹ì„ ì ìš©í•  ì…€ì„ ì„ íƒí•˜ì„¸ìš”.');
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  const minValue = document.getElementById('minValue').value;
  const maxValue = document.getElementById('maxValue').value;
  
  // ì„ íƒëœ ì…€ë“¤ì˜ ì—´ ì¸ë±ìŠ¤ ì¶”ì¶œ
  const selectedColumns = new Set(selected.map(cell => cell.cellIndex));
  
  selected.forEach(cell => {
    // í˜„ì¬ ì…€ì˜ ê°’ì„ ê°€ì ¸ì˜´
    let currentValue = cell.textContent.trim();
    
    // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±° (ë‹¨ìœ„ ë“±)
    currentValue = currentValue.replace(/[^0-9.-]/g, '');
    
    // ìˆ«ìë¡œ ë³€í™˜
    let numValue = parseFloat(currentValue);
    if (isNaN(numValue)) {
      numValue = 0;
    }
    
    // ë²”ìœ„ ì²´í¬
    if (minValue && numValue < parseFloat(minValue)) {
      numValue = parseFloat(minValue);
    }
    if (maxValue && numValue > parseFloat(maxValue)) {
      numValue = parseFloat(maxValue);
    }
    
    // í˜•ì‹ ì ìš©
    cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    
    // ë°ì´í„° ì†ì„± ì €ì¥
    cell.setAttribute('data-number-format', format);
    cell.setAttribute('data-unit-type', unitType);
    cell.setAttribute('data-unit-prefix', prefix);
    cell.setAttribute('data-unit-suffix', suffix);
    cell.setAttribute('data-min-value', minValue);
    cell.setAttribute('data-max-value', maxValue);
    
    // ìš°ì¸¡ ì •ë ¬ ì ìš©
    cell.style.textAlign = 'right';
  });
  
  // ì„ íƒëœ ì—´ì˜ ìë™ ì—´í­ ì¡°ì •
  adjustColumnWidths(selectedColumns);
  
  numberMode = false;
  clearSelection();
  document.getElementById('numberPanel').style.display = 'none';
}

function adjustColumnWidths(selectedColumns) {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // ê° ì„ íƒëœ ì—´ì— ëŒ€í•´
  selectedColumns.forEach(colIndex => {
    let maxWidth = 0;
    const padding = 20; // ì…€ íŒ¨ë”© ê³ ë ¤
    
    // í•´ë‹¹ ì—´ì˜ ëª¨ë“  ì…€ì„ ê²€ì‚¬í•˜ì—¬ ìµœëŒ€ ë„ˆë¹„ ê³„ì‚°
    for (let i = 0; i < rows.length; i++) {
      const cell = rows[i].cells[colIndex];
      if (cell) {
        // ì„ì‹œ span ìš”ì†Œë¥¼ ìƒì„±í•˜ì—¬ ì‹¤ì œ í…ìŠ¤íŠ¸ ë„ˆë¹„ ì¸¡ì •
        const span = document.createElement('span');
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'nowrap';
        span.style.font = window.getComputedStyle(cell).font;
        span.textContent = cell.textContent;
        document.body.appendChild(span);
        
        const width = span.offsetWidth + padding;
        maxWidth = Math.max(maxWidth, width);
        
        document.body.removeChild(span);
      }
    }
    
    // ìµœì†Œ ë„ˆë¹„ ì„¤ì • (ìµœì†Œ 100px)
    maxWidth = Math.max(maxWidth, 100);
    
    // í•´ë‹¹ ì—´ì˜ ëª¨ë“  ì…€ì— ë„ˆë¹„ ì ìš©
    for (let i = 0; i < rows.length; i++) {
      const cell = rows[i].cells[colIndex];
      if (cell) {
        cell.style.width = maxWidth + 'px';
        cell.style.minWidth = maxWidth + 'px';
      }
    }
  });
}

// ìˆ«ì ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
document.getElementById('numberFormat').addEventListener('change', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = this.value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitType').addEventListener('change', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = this.value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitPrefix').addEventListener('input', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = this.value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitSuffix').addEventListener('input', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = this.value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

function removeSumRows() {
  const tbody = document.getElementById('tbody');
  const sumRows = Array.from(tbody.rows).filter(row => row.cells[0].textContent === 'í•©ê³„');
  
  if (sumRows.length === 0) {
    alert('ì œê±°í•  í•©ê³„ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  // ê°€ì¥ ë§ˆì§€ë§‰ í•©ê³„ í–‰ë§Œ ì œê±°
  const lastSumRow = sumRows[sumRows.length - 1];
  lastSumRow.remove();
}

function addSumRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  const rows = tbody.rows;
  
  // ì²« ë²ˆì§¸ í•©ê³„ í–‰ ì°¾ê¸°
  let firstSumRow = null;
  for (let i = 0; i < rows.length; i++) {
    if (rows[i].cells[0].textContent === 'í•©ê³„') {
      firstSumRow = rows[i];
      break;
    }
  }
  
  let newRow;
  if (firstSumRow) {
    // ì²« ë²ˆì§¸ í•©ê³„ í–‰ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ê¸°ì¤€ìœ¼ë¡œ ë³µì‚¬
    newRow = document.createElement('tr');
    // ì²« ë²ˆì§¸ í•©ê³„ í–‰ì˜ ì…€ ìˆ˜ë§Œí¼ ë¹ˆ ì…€ ìƒì„±
    for (let i = 0; i < firstSumRow.cells.length; i++) {
      const newCell = document.createElement('td');
      newCell.style.backgroundColor = '#DAF2D0';
      // ëª¨ë“œ ì ìš©ì„ ìœ„í•œ ì†ì„± ì¶”ê°€
      newCell.contentEditable = 'true';
      newCell.onmousedown = e => {
        if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
        e.preventDefault();
        if (!isSelecting) {
          saveState();
          isSelecting = true;
        }
        newCell.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      };
      newCell.onmouseover = e => {
        if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
          e.target.classList.add('selected');
          if (numberMode) {
            updateMultiInput();
          }
        }
      };
      newCell.onmouseup = () => {
        isSelecting = false;
      };
      newRow.appendChild(newCell);
    }
  } else {
    // ì²« ë²ˆì§¸ í•©ê³„ í–‰ì´ ì—†ìœ¼ë©´ ë§ˆì§€ë§‰ í–‰ì„ ë³µì‚¬
    const lastRow = rows[rows.length - 1];
    newRow = lastRow.cloneNode(true);
    // ë°°ê²½ìƒ‰ ì ìš©
    Array.from(newRow.cells).forEach(cell => {
      cell.style.backgroundColor = '#DAF2D0';
      // ëª¨ë“œ ì ìš©ì„ ìœ„í•œ ì†ì„± ì¶”ê°€
      cell.contentEditable = 'true';
      cell.onmousedown = e => {
        if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
        e.preventDefault();
        if (!isSelecting) {
          saveState();
          isSelecting = true;
        }
        cell.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      };
      cell.onmouseover = e => {
        if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
          e.target.classList.add('selected');
          if (numberMode) {
            updateMultiInput();
          }
        }
      };
      cell.onmouseup = () => {
        isSelecting = false;
      };
    });
  }
  
  // ê° ì—´ì˜ í•©ê³„ ê³„ì‚°
  const table = document.getElementById('editableTable');
  
  for (let colIndex = 0; colIndex < newRow.cells.length; colIndex++) {
    let sum = 0;
    let hasNumbers = false;
    let numberFormat = '';
    let unitType = '';
    let unitPrefix = '';
    let unitSuffix = '';
    let originalFormat = null;
    
    // í•´ë‹¹ ì—´ì˜ ëª¨ë“  í–‰ì„ ê²€ì‚¬ (í•©ê³„ í–‰ ì œì™¸)
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell && rows[rowIndex].cells[0].textContent !== 'í•©ê³„') {
        // ìˆ«ì í˜•ì‹ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        if (rowIndex === 0) {
          numberFormat = cell.getAttribute('data-number-format') || '';
          unitType = cell.getAttribute('data-unit-type') || '';
          unitPrefix = cell.getAttribute('data-unit-prefix') || '';
          unitSuffix = cell.getAttribute('data-unit-suffix') || '';
        }
        
        // ìˆ«ì ê°’ ì¶”ì¶œ ë° í•©ì‚°
        const value = cell.textContent.trim();
        // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±° (ë‹¨ìœ„ ë“±)
        const numValue = parseFloat(value.replace(/[^0-9.-]/g, ''));
        if (!isNaN(numValue)) {
          sum += numValue;
          hasNumbers = true;
          // ì›ë³¸ í¬ë§· ì €ì¥
          if (!originalFormat && value !== numValue.toString()) {
            originalFormat = value;
          }
        }
      }
    }
    
    // í•©ê³„ ì ìš©
    if (hasNumbers) {
      let formattedSum;
      if (originalFormat) {
        // ì›ë³¸ í¬ë§·ì´ ìˆëŠ” ê²½ìš° í•´ë‹¹ í¬ë§· ìœ ì§€
        formattedSum = originalFormat.replace(/[0-9,.-]+/g, sum.toLocaleString('ko-KR'));
      } else {
        // ì›ë³¸ í¬ë§·ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ í¬ë§· ì ìš©
        formattedSum = formatNumber(sum, numberFormat, unitType, unitPrefix, unitSuffix);
      }
      newRow.cells[colIndex].textContent = formattedSum;
      newRow.cells[colIndex].style.fontWeight = 'bold';
      newRow.cells[colIndex].style.textAlign = 'right';
    }
  }
  
  // NO.ì™€ í•­ëª© ì…€ ë³‘í•©
  if (firstSumRow) {
    // ì²« ë²ˆì§¸ í•©ê³„ í–‰ì´ ìˆëŠ” ê²½ìš°, ë™ì¼í•œ êµ¬ì¡°ë¡œ ë³‘í•©
    newRow.cells[0].colSpan = firstSumRow.cells[0].colSpan;
    // ë³‘í•©ëœ ì…€ ì´í›„ì˜ ì…€ë“¤ ì œê±°
    for (let i = newRow.cells.length - 1; i >= firstSumRow.cells.length; i--) {
      newRow.deleteCell(i);
    }
  } else {
    // ì²« ë²ˆì§¸ í•©ê³„ í–‰ì´ ì—†ëŠ” ê²½ìš°, ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ë³‘í•©
    newRow.cells[0].colSpan = 2;
    newRow.cells[1].remove();
  }
  
  newRow.cells[0].textContent = 'í•©ê³„';
  newRow.cells[0].style.fontWeight = 'bold';
  newRow.cells[0].style.textAlign = 'center';
  
  // ìƒˆ í–‰ ì¶”ê°€
  tbody.appendChild(newRow);
  
  // ëª¨ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •
  initSelectable();
}

function toggleTableManipulation() {
  const panel = document.getElementById('tableManipulationPanel');
  panel.style.display = 'block';
  initTableManipulationPanelDrag();
  updateTableStatus();
}

function cancelTableManipulation() {
  const panel = document.getElementById('tableManipulationPanel');
  panel.style.display = 'none';
  panel.style.transform = 'translate(0, 0)';
}

function initTableManipulationPanelDrag() {
  const panel = document.getElementById('tableManipulationPanel');
  const title = panel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, panel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateTableStatus() {
  const tbody = document.getElementById('tbody');
  const thead = document.querySelector('#editableTable thead');
  const status = document.getElementById('tableStatus');
  
  const rowCount = tbody.rows.length;
  const headerCount = thead.rows.length;
  const columnCount = thead.rows[0].cells.length;
  
  status.textContent = `ì œëª© í–‰ ${headerCount}ê°œ, ì…ë ¥ í–‰ ${rowCount}ê°œ, ì—´ ${columnCount}ê°œ`;
}

for (let i = 0; i < 10; i++) addRow();
initSelectable();  // âœ… ì…€ ì„ íƒ ì´ë²¤íŠ¸ í™œì„±í™”ë¥¼ ìœ„í•œ í˜¸ì¶œ ì¶”ê°€

function updateSumRowStatus() {
  const tbody = document.getElementById('tbody');
  const sumRows = Array.from(tbody.rows).filter(row => row.cells[0].textContent === 'í•©ê³„');
  const status = document.getElementById('sumRowStatus');
  const list = document.getElementById('sumRowList');
  
  // ìƒíƒœ ì—…ë°ì´íŠ¸
  status.textContent = `í˜„ì¬ ${sumRows.length}ê°œì˜ í•©ê³„ í–‰ì´ ìˆìŠµë‹ˆë‹¤.`;
  
  // í•©ê³„ í–‰ ëª©ë¡ ì—…ë°ì´íŠ¸
  list.innerHTML = '';
  sumRows.forEach((row, index) => {
    const item = document.createElement('div');
    item.className = 'sum-row-item';
    item.innerHTML = `
      <div class="sum-row-info">í•©ê³„ í–‰ ${index + 1}</div>
      <button class="sum-row-remove" onclick="removeSpecificSumRow(${index})">ì œê±°</button>
    `;
    list.appendChild(item);
  });
  
  if (sumRows.length === 0) {
    const item = document.createElement('div');
    item.className = 'sum-row-item';
    item.innerHTML = '<div class="sum-row-info">í•©ê³„ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    list.appendChild(item);
  }
}

function autoAdjustColumnWidths() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  const padding = 20; // ì…€ íŒ¨ë”© ê³ ë ¤
  const minWidth = 100; // ìµœì†Œ ë„ˆë¹„
  const maxWidth = 500; // ìµœëŒ€ ë„ˆë¹„
  
  // í…Œì´ë¸”ì„ ì œëª© í—¤ë”ì˜ "í˜‘" ì ë ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
  const title = document.querySelector('h2');
  const titleText = title.textContent;
  const span = document.createElement('span');
  span.style.visibility = 'hidden';
  span.style.position = 'absolute';
  span.style.whiteSpace = 'nowrap';
  span.style.font = window.getComputedStyle(title).font;
  span.textContent = titleText.substring(0, titleText.indexOf('í˜‘') + 1);
  document.body.appendChild(span);
  
  const titleLeft = title.getBoundingClientRect().left;
  const titleWidth = span.offsetWidth;
  const tableLeft = table.getBoundingClientRect().left;
  const offset = (titleLeft + titleWidth) - tableLeft;
  
  document.body.removeChild(span);
  
  table.style.margin = '0';
  table.style.marginLeft = offset + 'px';
  table.style.width = 'auto';
  table.style.tableLayout = 'fixed';
  
  // NO. ì—´ì˜ ë„ˆë¹„ ê³ ì •
  const noColumnWidth = 60; // NO. ì—´ì˜ ê³ ì • ë„ˆë¹„
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const cell = rows[rowIndex].cells[0];
    if (cell) {
      cell.style.width = noColumnWidth + 'px';
      cell.style.minWidth = noColumnWidth + 'px';
    }
  }
  
  // ë‚˜ë¨¸ì§€ ì—´ì— ëŒ€í•´ ìë™ ì¡°ì •
  for (let colIndex = 1; colIndex < rows[0].cells.length; colIndex++) {
    let maxWidth = minWidth;
    
    // í•´ë‹¹ ì—´ì˜ ëª¨ë“  ì…€ì„ ê²€ì‚¬
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell) {
        // ì„ì‹œ span ìš”ì†Œë¥¼ ìƒì„±í•˜ì—¬ ì‹¤ì œ í…ìŠ¤íŠ¸ ë„ˆë¹„ ì¸¡ì •
        const span = document.createElement('span');
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'nowrap';
        span.style.font = window.getComputedStyle(cell).font;
        span.textContent = cell.textContent;
        document.body.appendChild(span);
        
        const width = span.offsetWidth + padding;
        maxWidth = Math.max(maxWidth, Math.min(width, maxWidth));
        
        document.body.removeChild(span);
      }
    }
    
    // í•´ë‹¹ ì—´ì˜ ëª¨ë“  ì…€ì— ë„ˆë¹„ ì ìš©
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell) {
        cell.style.width = maxWidth + 'px';
        cell.style.minWidth = maxWidth + 'px';
      }
    }
  }
}

function resetColumnWidths() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // ëª¨ë“  ì…€ì˜ ë„ˆë¹„ ì´ˆê¸°í™”
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const cells = rows[rowIndex].cells;
    for (let colIndex = 0; colIndex < cells.length; colIndex++) {
      const cell = cells[colIndex];
      cell.style.width = '';
      cell.style.minWidth = '';
    }
  }
  
  // í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™” ë° ì¤‘ì•™ ì •ë ¬ ë³µì›
  table.style.width = '100%';
  table.style.tableLayout = 'auto';
  table.style.margin = '0 auto';
}

function adjustRowHeights() {
  const tbody = document.getElementById('tbody');
  const rows = tbody.rows;
  const availableHeight = window.innerHeight - document.querySelector('h2').offsetHeight - document.querySelector('.controls').offsetHeight - 40;
  const rowHeight = Math.max(24, Math.floor(availableHeight / rows.length));
  
  for (let i = 0; i < rows.length; i++) {
    rows[i].style.height = rowHeight + 'px';
    Array.from(rows[i].cells).forEach(cell => {
      cell.style.height = rowHeight + 'px';
      cell.style.padding = '2px';
      cell.style.lineHeight = '1.2';
    });
  }
}

// ì°½ í¬ê¸°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í–‰ ë†’ì´ ì¡°ì •
window.addEventListener('resize', adjustRowHeights);

// ì´ˆê¸° ë¡œë“œ ì‹œ í–‰ ë†’ì´ ì¡°ì •
window.addEventListener('load', adjustRowHeights);

function autoAdjustRowHeights() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  const minHeight = 24; // ìµœì†Œ í–‰ ë†’ì´
  const maxHeight = 200; // ìµœëŒ€ í–‰ ë†’ì´
  const padding = 6; // ì…€ íŒ¨ë”© ê³ ë ¤
  
  // ê° í–‰ì— ëŒ€í•´
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    let maxHeight = minHeight;
    
    // í•´ë‹¹ í–‰ì˜ ëª¨ë“  ì…€ì„ ê²€ì‚¬
    for (let colIndex = 0; colIndex < row.cells.length; colIndex++) {
      const cell = row.cells[colIndex];
      if (cell) {
        // ì„ì‹œ div ìš”ì†Œë¥¼ ìƒì„±í•˜ì—¬ ì‹¤ì œ í…ìŠ¤íŠ¸ ë†’ì´ ì¸¡ì •
        const div = document.createElement('div');
        div.style.visibility = 'hidden';
        div.style.position = 'absolute';
        div.style.width = cell.offsetWidth + 'px';
        div.style.padding = window.getComputedStyle(cell).padding;
        div.style.font = window.getComputedStyle(cell).font;
        div.style.whiteSpace = 'pre-wrap';
        div.style.wordBreak = 'break-word';
        div.innerHTML = cell.innerHTML;
        document.body.appendChild(div);
        
        const height = div.offsetHeight + padding;
        maxHeight = Math.max(maxHeight, Math.min(height, maxHeight));
        
        document.body.removeChild(div);
      }
    }
    
    // í–‰ ë†’ì´ ì ìš©
    row.style.height = maxHeight + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = maxHeight + 'px';
      cell.style.minHeight = maxHeight + 'px';
    });
  }
}

function resetRowHeights() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // ëª¨ë“  í–‰ì˜ ë†’ì´ ì´ˆê¸°í™”
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = '';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = '';
      cell.style.minHeight = '';
    });
  }
}

function setManualRowHeight() {
  const heightInput = document.getElementById('rowHeightInput');
  const height = parseInt(heightInput.value);
  
  if (isNaN(height) || height < 24 || height > 200) {
    alert('í–‰ ë†’ì´ëŠ” 24pxì—ì„œ 200px ì‚¬ì´ì˜ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // ëª¨ë“  í–‰ì— ì§€ì •ëœ ë†’ì´ ì ìš©
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = height + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = height + 'px';
      cell.style.minHeight = height + 'px';
    });
  }
}

// í–‰ ë†’ì´ ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
document.getElementById('rowHeightInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    setManualRowHeight();
  }
});

function setRowHeight(height) {
  const slider = document.getElementById('rowHeightSlider');
  const display = document.getElementById('currentRowHeight');
  
  slider.value = height;
  display.textContent = height;
  
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = height + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = height + 'px';
      cell.style.minHeight = height + 'px';
    });
  }
}

// ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
document.getElementById('rowHeightSlider').addEventListener('input', function(e) {
  const height = parseInt(e.target.value);
  document.getElementById('currentRowHeight').textContent = height;
  setRowHeight(height);
});

// ì´ˆê¸° í–‰ ë†’ì´ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateRowHeightDisplay() {
  const table = document.getElementById('editableTable');
  const firstRow = table.rows[0];
  const height = firstRow.style.height ? parseInt(firstRow.style.height) : 24;
  
  const slider = document.getElementById('rowHeightSlider');
  const display = document.getElementById('currentRowHeight');
  
  slider.value = height;
  display.textContent = height;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° í–‰ ë†’ì´ í‘œì‹œ
window.addEventListener('load', updateRowHeightDisplay);

function toggleRowHeightPanel() {
  const panel = document.getElementById('rowHeightPanel');
  panel.style.display = 'block';
  initRowHeightPanelDrag();
  updateRowHeightDisplay();
}

function cancelRowHeightPanel() {
  const panel = document.getElementById('rowHeightPanel');
  panel.style.display = 'none';
  panel.style.transform = 'translate(0, 0)';
}

function initRowHeightPanelDrag() {
  const panel = document.getElementById('rowHeightPanel');
  const title = panel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, panel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}
</script>

</body>
</html>