<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ÌòëÏùò ÎÇ¥Ïö© ÏûëÏÑ± ÏãúÌä∏</title>
  <style>
    html, body {
      font-size: 18px;
      font-family: 'ÎßëÏùÄ Í≥†Îîï', sans-serif;
      margin: 0;
      padding: 0;
    }
    body.fullscreen-mode #controls {
      display: none;
    }
    h2 {
      margin: 10px 20px;
      cursor: text;
      font-size: 24px;
      padding-left: 0;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 10px;
      background: #eef8ff;
      font-size: 14px;
    }
    .group {
      position: relative;
      background: #eaf4ff;
      padding: 4px;
      border-radius: 6px;
      margin-right: 6px;
      min-width: 80px;
      max-width: fit-content;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      height: auto;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .group-title {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 2px;
      color: #2c5282;
      white-space: nowrap;
    }
    .group button {
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #999;
      background: #f2f2f2;
      border-radius: 4px;
      margin: 1px;
      white-space: nowrap;
      height: 20px;
      line-height: 1;
    }
    .group .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .group:nth-child(1) { background: #fff2e6; } /* ÌååÏùº - Ïó∞Ìïú Ï£ºÌô©ÏÉâ */
    .group:nth-child(2) { background: #e6f3ff; } /* Ï†ÑÏ≤¥ÌôîÎ©¥ - Ïó∞Ìïú ÌååÎûÄÏÉâ */
    .group:nth-child(3) { background: #e6ffff; } /* Ïä§ÌÉÄÏùº - Ï≤≠Î°ùÏÉâ */
    .group:nth-child(4) { background: #f0e6ff; } /* ÌïòÏù¥ÌçºÎßÅÌÅ¨ - Ïó∞Ìïú Î≥¥ÎùºÏÉâ */
    .group:nth-child(5) { background: #fff0f5; } /* Ïà´Ïûê ÏûÖÎ†• - Ïó∞Ìïú Î∂ÑÌôçÏÉâ */
    .group:nth-child(6) { background: #e6ffe6; } /* Ìï©Í≥Ñ Ìñâ - Ïó∞Ìïú Ï¥àÎ°ùÏÉâ */
    .group:nth-child(7) { background: #ffe6e6; } /* Ìñâ/Ïó¥ Ï°∞Ïûë - Ïó∞Ìïú Îπ®Í∞ÑÏÉâ */
    .group:nth-child(8) { background: #e6e6ff; } /* Ïó¥ Ìè≠ Ï°∞Ï†ï - Ïó∞Ìïú ÌååÎûÄÏÉâ */
    .group:nth-child(9) { background: #fff8e6; } /* Î≥ëÌï© - Ïó∞Ìïú ÎÖ∏ÎûÄÏÉâ */
    .group:nth-child(10) { background: #f0f0f0; } /* Ï†ïÎ†¨ - Ïó∞Ìïú ÌöåÏÉâ */
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: auto;
      font-size: 18px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 3px;
      text-align: center;
      vertical-align: middle;
      resize: both;
      overflow: hidden;
      white-space: pre-wrap;
      min-height: 24px;
      height: 100%;
      line-height: 1.2;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    th[contenteditable="true"], td[contenteditable="true"] {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: text;
      caret-color: transparent;
    }
    th[contenteditable="true"]:focus, td[contenteditable="true"]:focus {
      outline: 2px solid #4a90e2;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      caret-color: transparent;
    }
    th[contenteditable="true"]:focus::after, td[contenteditable="true"]:focus::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 1.2em;
      background-color: #000;
    }
    th > *, td > * {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    th {
      background: #dceeff;
      font-weight: bold;
    }
    th:first-child, td:first-child {
      width: 1%;
      white-space: nowrap;
    }
    td[contenteditable], th[contenteditable] {
      cursor: text;
    }
    .selected {
      outline: 2px solid #4a90e2;
    }
    .fullscreen-mode {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      z-index: 9999;
      padding: 20px;
      overflow: auto;
      height: 100vh;
      box-sizing: border-box;
    }
    .fullscreen-mode h2 {
      margin: 10px 20px;
      padding-left: 0;
    }
    .fullscreen-mode .controls {
      background: #eef8ff;
    }
    .fullscreen-mode #editableTable {
      max-width: calc(100% - 40px);
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow-x: auto;
      display: table;
      table-layout: fixed;
      width: 100%;
    }
    .fullscreen-mode #editableTable thead {
      background: #fff;
    }
    .fullscreen-mode #editableTable thead th {
      background: #dceeff;
    }
    .fullscreen-mode #editableTable tbody {
      display: table-row-group;
    }
    .fullscreen-mode #editableTable tr {
      display: table-row;
    }
    .fullscreen-mode #editableTable td,
    .fullscreen-mode #editableTable th {
      display: table-cell;
      white-space: normal;
      word-wrap: break-word;
    }
    #editableTable {
      margin: 0 auto;
      max-width: calc(100% - 40px);
    }
    #editableTable tbody {
      display: table-row-group;
    }
    #editableTable tr {
      display: table-row;
    }
    #editableTable td, #editableTable th {
      display: table-cell;
      align-items: center;
      justify-content: center;
      min-height: 40px;
      height: 100%;
    }
    .style-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .style-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .style-panel .title::before {
      content: "üé®";
      margin-right: 8px;
    }
    .style-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .style-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .style-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .style-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .style-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .style-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .style-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .style-panel button.apply {
      background: #28a745;
      color: white;
    }
    .style-panel button.close {
      background: #6c757d;
      color: white;
    }
    .style-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .style-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .style-panel .info-content p {
      margin: 5px 0;
    }
    .style-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .style-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .style-panel .preset-sizes {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .style-panel .preset-sizes button {
      padding: 2px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    .style-panel .preset-sizes button:hover {
      background: #dee2e6;
    }
    .style-panel .preset-colors {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .style-panel .preset-colors button {
      width: 20px;
      height: 20px;
      padding: 0;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    tbody tr:nth-child(even) {
      background-color: rgba(220, 220, 220, 0.2);
    }
    .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      margin-top: 5px;
    }
    .group:hover .tooltip {
      display: block;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }
    .align-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .align-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .align-panel .title::before {
      content: "‚ÜîÔ∏è";
      margin-right: 8px;
    }
    .align-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .align-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .align-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .align-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .align-panel .align-buttons {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .align-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .align-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .align-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .align-panel button.close {
      background: #6c757d;
      color: white;
    }
    .align-panel .align-buttons button {
      justify-content: flex-start;
      padding: 10px 15px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      color: #495057;
    }
    .align-panel .align-buttons button:hover {
      background: #e9ecef;
    }
    .align-panel .align-buttons button .icon {
      font-size: 16px;
      margin-right: 10px;
    }
    .align-panel .align-buttons button .text {
      font-size: 13px;
    }
    .align-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .align-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .align-panel .info-content p {
      margin: 5px 0;
    }
    .align-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .align-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .edit-mode-button {
      position: fixed;
      top: 5px;
      left: 10px;
      padding: 4px 8px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      z-index: 10000;
      display: none;
      transform: scale(0.85);
    }
    .fullscreen-mode .edit-mode-button {
      display: block;
    }
    .mode-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 10001;
      font-size: 14px;
      text-align: center;
      display: none;
    }
    .number-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 250px;
    }
    .number-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .number-panel .title::before {
      content: "üî¢";
      margin-right: 8px;
    }
    .number-panel .number-group {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #dee2e6;
    }
    .number-panel .number-group:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .number-panel label {
      font-size: 13px;
      color: #495057;
      display: block;
      margin-bottom: 8px;
    }
    .number-panel select, .number-panel input {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      margin-bottom: 8px;
    }
    .number-panel .preset-buttons {
      display: flex;
      gap: 5px;
      margin-top: 5px;
      flex-wrap: wrap;
    }
    .number-panel .preset-buttons button {
      padding: 2px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }
    .number-panel .preset-buttons button:hover {
      background: #dee2e6;
    }
    .number-panel .unit-group {
      display: flex;
      gap: 10px;
    }
    .number-panel .unit-group input {
      flex: 1;
    }
    .number-panel .multi-input {
      margin-top: 10px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      display: none;
    }
    .number-panel .multi-input.active {
      display: block;
    }
    .number-panel .cell-input {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      padding: 5px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .number-panel .cell-input label {
      margin: 0;
      margin-right: 10px;
      min-width: 60px;
    }
    .number-panel .cell-input input {
      flex: 1;
      margin: 0;
    }
    .number-panel .quick-input {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }
    .number-panel .quick-input button {
      flex: 1;
      padding: 5px;
      font-size: 12px;
    }
    .number-panel button {
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid #ced4da;
      background: #e9ecef;
      border-radius: 4px;
      margin: 2px;
      transition: all 0.2s ease;
    }
    .number-panel button:hover {
      background: #dee2e6;
    }
    .number-panel .number-group:last-child button {
      padding: 5px 15px;
      font-size: 14px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .number-panel .number-group:last-child button:last-child {
      background: #6c757d;
    }
    .number-panel .number-group:last-child button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .sum-button-group {
      position: relative;
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .sum-button-group .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      margin-top: 5px;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }
    .sum-button-group:hover .tooltip {
      display: block;
    }
    .hyperlink-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .hyperlink-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .hyperlink-panel .title::before {
      content: "üîó";
      margin-right: 8px;
    }
    .hyperlink-panel .hyperlink-group {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #dee2e6;
    }
    .hyperlink-panel .hyperlink-list {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
    }
    .hyperlink-panel .hyperlink-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .hyperlink-panel .hyperlink-item input {
      flex: 1;
      padding: 6px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 13px;
    }
    .hyperlink-panel .hyperlink-item .remove-btn {
      padding: 6px 10px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .hyperlink-panel .add-btn {
      width: 100%;
      padding: 8px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    .hyperlink-panel .current-links {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .hyperlink-panel .current-links h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #495057;
    }
    .hyperlink-panel .current-links ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .hyperlink-panel .current-links li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
      font-size: 13px;
      color: #495057;
    }
    .hyperlink-panel .current-links .link-count {
      color: #6c757d;
      font-size: 12px;
    }
    .hyperlink-panel button {
      padding: 8px 15px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .hyperlink-panel button.apply {
      background: #4a90e2;
      color: white;
    }
    .hyperlink-panel button.cancel {
      background: #6c757d;
      color: white;
    }
    .hyperlink-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .table-manipulation-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .table-manipulation-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .table-manipulation-panel .title::before {
      content: "üìä";
      margin-right: 8px;
    }
    .table-manipulation-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .table-manipulation-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .table-manipulation-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .table-manipulation-panel .section-title::before {
      margin-right: 8px;
      font-size: 16px;
    }
    .table-manipulation-panel .section.rows .section-title::before {
      content: "‚ÜïÔ∏è";
    }
    .table-manipulation-panel .section.columns .section-title::before {
      content: "‚ÜîÔ∏è";
    }
    .table-manipulation-panel .section.headers .section-title::before {
      content: "üìë";
    }
    .table-manipulation-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .table-manipulation-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .table-manipulation-panel button.add {
      background: #28a745;
      color: white;
    }
    .table-manipulation-panel button.remove {
      background: #dc3545;
      color: white;
    }
    .table-manipulation-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .table-manipulation-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .table-manipulation-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .sum-row-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .sum-row-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sum-row-panel .title::before {
      content: "üßÆ";
      margin-right: 8px;
    }
    .sum-row-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .sum-row-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .sum-row-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .sum-row-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .sum-row-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .sum-row-panel button.add {
      background: #28a745;
      color: white;
    }
    .sum-row-panel button.remove {
      background: #dc3545;
      color: white;
    }
    .sum-row-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .sum-row-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .sum-row-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }
    .sum-row-panel .sum-row-list {
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
    }
    .sum-row-panel .sum-row-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .sum-row-panel .sum-row-item:last-child {
      margin-bottom: 0;
    }
    .sum-row-panel .sum-row-info {
      font-size: 13px;
      color: #495057;
    }
    .sum-row-panel .sum-row-remove {
      padding: 4px 8px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .merge-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }
    .merge-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .merge-panel .title::before {
      content: "üîó";
      margin-right: 8px;
    }
    .merge-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .merge-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .merge-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .merge-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .merge-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .merge-panel button.mode {
      background: #4a90e2;
      color: white;
    }
    .merge-panel button.merge {
      background: #28a745;
      color: white;
    }
    .merge-panel button.undo {
      background: #ffc107;
      color: #000;
    }
    .merge-panel button.cancel {
      background: #dc3545;
      color: white;
    }
    .merge-panel button.close {
      background: #6c757d;
      color: white;
    }
    .merge-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .merge-panel .info-content {
      font-size: 13px;
      color: #495057;
      line-height: 1.5;
    }
    .merge-panel .info-content p {
      margin: 5px 0;
    }
    .merge-panel .status {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      color: #495057;
    }
    .merge-panel .status span {
      font-weight: bold;
      color: #2c5282;
    }

    @media print {
      .controls,
      .group,
      .group-title,
      .group button,
      .group .tooltip,
      .style-panel,
      .align-panel,
      .number-panel,
      .hyperlink-panel,
      .table-manipulation-panel,
      .sum-row-panel,
      .merge-panel,
      .edit-mode-button,
      .mode-message {
        display: none !important;
      }

      body {
        margin: 0;
        padding: 20px;
      }

      #editableTable {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
      }

      #editableTable th:first-child,
      #editableTable td:first-child {
        width: auto;
        min-width: auto;
        white-space: nowrap;
      }

      #editableTable th,
      #editableTable td {
        border: 1px solid #aaa;
        padding: 3px;
        text-align: center;
        vertical-align: middle;
        min-height: 24px;
        height: 100%;
        line-height: 1.2;
        white-space: pre-wrap;
        overflow: hidden;
        background-color: inherit !important;
        color: inherit !important;
      }

      #editableTable th {
        background-color: #dceeff !important;
        font-weight: bold;
      }

      #editableTable tbody tr:nth-child(even) {
        background-color: rgba(220, 220, 220, 0.2) !important;
      }

      #editableTable td[style*="background-color: #DAF2D0"] {
        background-color: #DAF2D0 !important;
      }

      #editableTable td[style*="font-weight: bold"] {
        font-weight: bold !important;
      }

      #editableTable td[style*="text-align: right"] {
        text-align: right !important;
      }

      #editableTable td[style*="text-align: left"] {
        text-align: left !important;
      }

      #editableTable td[style*="text-align: center"] {
        text-align: center !important;
      }

      #editableTable td[style*="font-size"] {
        font-size: inherit !important;
      }

      #editableTable td[style*="color"] {
        color: inherit !important;
      }
    }

    .row-height-control {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 4px;
      flex: 1;
      margin-left: 4px;
      position: relative;
    }

    .row-height-control .tooltip {
      display: none;
    }

    .row-height-control:hover .tooltip {
      display: none;
    }

    .row-height-display {
      display: flex;
      align-items: center;
      gap: 2px;
      font-size: 12px;
      color: #333;
      white-space: nowrap;
      min-width: 60px;
    }

    .row-height-display #currentRowHeight {
      font-weight: bold;
      color: #2c5282;
      min-width: 30px;
      text-align: right;
    }

    .row-height-slider {
      flex: 1;
      padding: 0 4px;
    }

    .row-height-slider input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 2px;
      outline: none;
    }

    .row-height-slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #4a90e2;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-slider input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #357abd;
    }

    .row-height-presets {
      display: flex;
      gap: 2px;
      white-space: nowrap;
    }

    .row-height-presets button {
      padding: 2px 4px;
      font-size: 11px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-presets button:hover {
      background: #e0e0e0;
      transform: translateY(-1px);
    }

    .row-height-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      display: none;
      z-index: 1000;
      cursor: move;
      user-select: none;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 300px;
    }

    .row-height-panel .title {
      margin: -15px -15px 15px -15px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: move;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .row-height-panel .title::before {
      content: "üìè";
      margin-right: 8px;
    }

    .row-height-panel .section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .row-height-panel .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .row-height-panel .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    .row-height-panel .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }

    .row-height-panel button {
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .row-height-panel button.close {
      background: #6c757d;
      color: white;
    }

    .row-height-panel button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .row-height-panel .row-height-control {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }

    .row-height-panel .row-height-display {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      color: #495057;
    }

    .row-height-panel .row-height-display #currentRowHeight {
      font-weight: bold;
      color: #2c5282;
      min-width: 30px;
      text-align: right;
    }

    .row-height-panel .row-height-slider {
      width: 100%;
    }

    .row-height-panel .row-height-slider input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 2px;
      outline: none;
    }

    .row-height-panel .row-height-slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #4a90e2;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .row-height-panel .row-height-slider input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      background: #357abd;
    }

    .row-height-panel .row-height-presets {
      display: flex;
      gap: 4px;
      justify-content: center;
    }

    .row-height-panel .row-height-presets button {
      padding: 4px 8px;
      font-size: 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
    }

    .row-height-panel .row-height-presets button:hover {
      background: #dee2e6;
    }
  </style>
</head>
<body>

<div id="controls" class="controls">
  <div class="group">
    <div class="group-title">ÌååÏùº</div>
    <button onclick="downloadHTML()">Îã§Ïö¥Î°úÎìú</button>
    <div class="tooltip">HTML ÌååÏùºÏùÑ Îã§Ïö¥Î°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Ï†ÑÏ≤¥ÌôîÎ©¥</div>
    <button onclick="toggleFullscreen()">Ï†ÑÏ≤¥ÌôîÎ©¥</button>
    <div class="tooltip">Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®ÎìúÎ•º Ï†ÑÌôòÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Ïä§ÌÉÄÏùº</div>
    <button onclick="toggleStyleMode()">Ïä§ÌÉÄÏùº Î™®Îìú</button>
    <div class="tooltip">ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Í∏ÄÏûê ÌÅ¨Í∏∞, ÍµµÍ∏∞, ÏÉâÏÉÅÏùÑ Ìïú Î≤àÏóê Ï†ÅÏö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">ÌïòÏù¥ÌçºÎßÅÌÅ¨</div>
    <button onclick="toggleHyperlinkMode()">ÌïòÏù¥ÌçºÎßÅÌÅ¨</button>
    <div class="tooltip">ÌïòÏù¥ÌçºÎßÅÌÅ¨Î•º ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Ïà´Ïûê ÏûÖÎ†•</div>
    <button onclick="toggleNumberMode()">Ïà´Ïûê ÏûÖÎ†• Î™®Îìú</button>
    <div class="tooltip">ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ïà´Ïûê ÌòïÏãùÍ≥º Îã®ÏúÑÎ•º ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Ìï©Í≥Ñ Ìñâ</div>
    <div class="sum-button-group">
      <button onclick="addSumRow()">Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä</button>
      <button onclick="removeSumRows()">Ìï©Í≥Ñ Ìñâ Ï†úÍ±∞</button>
      <div class="tooltip">Ìï©Í≥Ñ ÌñâÏùÑ Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò Ï†úÍ±∞Ìï† Ïàò ÏûàÏäµÎãàÎã§.</div>
    </div>
  </div>
  <div class="group">
    <div class="group-title">Ìñâ/Ïó¥ Ï°∞Ïûë</div>
    <button onclick="toggleTableManipulation()">Ìñâ/Ïó¥ Ï°∞Ïûë</button>
    <div class="tooltip">ÌÖåÏù¥Î∏îÏùò ÌñâÍ≥º Ïó¥ÏùÑ Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group" style="min-width: 200px;">
    <div class="group-title">Ïó¥ Ìè≠ Ï°∞Ï†ï</div>
    <div style="display: flex; gap: 4px; justify-content: center;">
      <button onclick="autoAdjustColumnWidths()">Ïó¥ Ìè≠ ÏûêÎèô Ï°∞Ï†ï</button>
      <button onclick="resetColumnWidths()">Ïó¥ Ìè≠ Ï¥àÍ∏∞Ìôî</button>
    </div>
    <div class="tooltip">ÌÖåÏù¥Î∏îÏùò Ïó¥ Ìè≠ÏùÑ ÎÇ¥Ïö©Ïóê ÎßûÍ≤å ÏûêÎèôÏúºÎ°ú Ï°∞Ï†ïÌï©ÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Î≥ëÌï©</div>
    <button onclick="toggleMergeMode()">Î≥ëÌï© Î™®Îìú</button>
    <div class="tooltip">ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Î≥ëÌï©ÌïòÍ±∞ÎÇò Î≥ëÌï©ÏùÑ Ï∑®ÏÜåÌï† Ïàò ÏûàÏäµÎãàÎã§. (ÎêòÎèåÎ¶¨Í∏∞ ÏµúÎåÄ 10Ìöå Í∞ÄÎä•)</div>
  </div>
  <div class="group">
    <div class="group-title">Ï†ïÎ†¨</div>
    <button onclick="toggleAlignMode()">Ï†ïÎ†¨ Î™®Îìú</button>
    <div class="tooltip">ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Ï†ïÎ†¨ Î∞©ÏãùÏùÑ Ï†ÅÏö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
  <div class="group">
    <div class="group-title">Ìñâ ÎÜíÏù¥ Ï°∞Ï†ï</div>
    <button onclick="toggleRowHeightPanel()">Ìñâ ÎÜíÏù¥ Ï°∞Ï†ï</button>
    <div class="tooltip">ÌÖåÏù¥Î∏îÏùò Ìñâ ÎÜíÏù¥Î•º ÏûêÎèôÏúºÎ°ú Ï°∞Ï†ïÌïòÍ±∞ÎÇò ÏßÅÏ†ë ÏßÄÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</div>
  </div>
</div>

<h2 contenteditable="true">ÌòëÏùò ÏïàÍ±¥ Î™©Î°ù</h2>

<table id="editableTable">
  <thead>
    <tr>
      <th>NO.</th>
      <th contenteditable="true">Ìï≠Î™©</th>
      <th contenteditable="true">Ïó∞Í¥ÄÏÑ±</th>
      <th contenteditable="true">ÏòàÏÇ∞</th>
      <th contenteditable="true">Í≥ÑÌöç</th>
      <th contenteditable="true">ÎπÑÏö©(ÏòàÏÉÅ)</th>
      <th contenteditable="true">ÏßÑÌñâ</th>
      <th contenteditable="true">Ïù¥Ïõî</th>
      <th contenteditable="true">ÎπÑÍ≥†</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div class="style-panel" id="stylePanel">
  <div class="title">Ïä§ÌÉÄÏùº ÏÑ§Ï†ï</div>
  <div class="section style-mode">
    <div class="section-title">Ïä§ÌÉÄÏùº Î™®Îìú</div>
    <div class="button-group">
      <button class="mode" onclick="toggleStyleMode()">Ïä§ÌÉÄÏùº Î™®Îìú ÌôúÏÑ±Ìôî</button>
      <button class="cancel" onclick="cancelStyleMode()">Ïä§ÌÉÄÏùº Î™®Îìú Ï∑®ÏÜå</button>
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">Í∏ÄÏûê ÌÅ¨Í∏∞</div>
    <div class="style-group">
      <input type="number" id="fontSize" min="10" max="40" value="18"> px
      <div class="preset-sizes">
        <button onclick="setFontSize(14)">ÏûëÍ≤å</button>
        <button onclick="setFontSize(18)">Î≥¥ÌÜµ</button>
        <button onclick="setFontSize(24)">ÌÅ¨Í≤å</button>
        <button onclick="setFontSize(32)">Îß§Ïö∞ ÌÅ¨Í≤å</button>
      </div>
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">Í∏ÄÏûê ÍµµÍ∏∞</div>
    <div class="style-group">
      <input type="checkbox" id="fontBold"> ÍµµÍ≤å
    </div>
  </div>
  <div class="section style-actions">
    <div class="section-title">Í∏ÄÏûê ÏÉâÏÉÅ</div>
    <div class="style-group">
      <input type="color" id="fontColor">
      <div class="preset-colors">
        <button style="background: #000000" onclick="setFontColor('#000000')"></button>
        <button style="background: #ff0000" onclick="setFontColor('#ff0000')"></button>
        <button style="background: #0000ff" onclick="setFontColor('#0000ff')"></button>
        <button style="background: #008000" onclick="setFontColor('#008000')"></button>
      </div>
    </div>
  </div>
  <div class="section style-info">
    <div class="section-title">Ïä§ÌÉÄÏùº Ï†ïÎ≥¥</div>
    <div class="info-content">
      <p>‚Ä¢ Ïä§ÌÉÄÏùº Î™®ÎìúÏóêÏÑú ÏÖÄÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ ÏõêÌïòÎäî Ïä§ÌÉÄÏùºÏùÑ ÏÑ§Ï†ïÌïòÍ≥† "Ïä§ÌÉÄÏùº Ï†ÅÏö©" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ Ïä§ÌÉÄÏùºÏùÑ Ï∑®ÏÜåÌïòÎ†§Î©¥ "Ïä§ÌÉÄÏùº Î™®Îìú Ï∑®ÏÜå" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ Ïó¨Îü¨ ÏÖÄÏùÑ ÎèôÏãúÏóê ÏÑ†ÌÉùÌïòÏó¨ Ìïú Î≤àÏóê Ïä§ÌÉÄÏùºÏùÑ Ï†ÅÏö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
    </div>
  </div>
  <div class="status">
    ÌòÑÏû¨ ÏÉÅÌÉú: <span id="styleStatus">ÎåÄÍ∏∞Ï§ë...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="apply" onclick="applyStyle()">Ïä§ÌÉÄÏùº Ï†ÅÏö©</button>
    <button class="close" onclick="cancelStyleMode()">Îã´Í∏∞</button>
  </div>
</div>

<div class="align-panel" id="alignPanel">
  <div class="title">ÏÖÄ Ï†ïÎ†¨</div>
  <div class="section align-mode">
    <div class="section-title">Ï†ïÎ†¨ Î™®Îìú</div>
    <div class="button-group">
      <button class="mode" onclick="toggleAlignMode()">Ï†ïÎ†¨ Î™®Îìú ÌôúÏÑ±Ìôî</button>
      <button class="cancel" onclick="cancelAlignMode()">Ï†ïÎ†¨ Î™®Îìú Ï∑®ÏÜå</button>
    </div>
  </div>
  <div class="section align-actions">
    <div class="section-title">Ï†ïÎ†¨ Î∞©Ìñ•</div>
    <div class="align-buttons">
      <button class="align-left" onclick="applyAlignment('left')">
        <span class="icon">‚¨ÖÔ∏è</span>
        <span class="text">Ï¢åÏ∏° Ï†ïÎ†¨</span>
      </button>
      <button class="align-center" onclick="applyAlignment('center')">
        <span class="icon">‚ÜîÔ∏è</span>
        <span class="text">Ï§ëÏïô Ï†ïÎ†¨</span>
      </button>
      <button class="align-right" onclick="applyAlignment('right')">
        <span class="icon">‚û°Ô∏è</span>
        <span class="text">Ïö∞Ï∏° Ï†ïÎ†¨</span>
      </button>
    </div>
  </div>
  <div class="section align-info">
    <div class="section-title">Ï†ïÎ†¨ Ï†ïÎ≥¥</div>
    <div class="info-content">
      <p>‚Ä¢ Ï†ïÎ†¨ Î™®ÎìúÏóêÏÑú ÏÖÄÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ ÏõêÌïòÎäî Ï†ïÎ†¨ Î∞©Ìñ• Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï†ïÎ†¨ÏùÑ Ï†ÅÏö©ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ Ï†ïÎ†¨ÏùÑ Ï∑®ÏÜåÌïòÎ†§Î©¥ "Ï†ïÎ†¨ Î™®Îìú Ï∑®ÏÜå" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ Ïó¨Îü¨ ÏÖÄÏùÑ ÎèôÏãúÏóê ÏÑ†ÌÉùÌïòÏó¨ Ìïú Î≤àÏóê Ï†ïÎ†¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
    </div>
  </div>
  <div class="status">
    ÌòÑÏû¨ ÏÉÅÌÉú: <span id="alignStatus">ÎåÄÍ∏∞Ï§ë...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelAlignMode()">Îã´Í∏∞</button>
  </div>
</div>

<div class="edit-mode-button" onclick="toggleFullscreen()">Ìé∏Ïßë Î™®ÎìúÎ°ú Ï†ÑÌôò</div>
<div id="modeMessage" class="mode-message"></div>

<div class="number-panel" id="numberPanel">
  <div class="title">Ïà´Ïûê ÏûÖÎ†• ÏÑ§Ï†ï</div>
  <div class="number-group">
    <label>ÏûÖÎ†• ÌòïÏãù</label>
    <select id="numberFormat">
      <option value="thousand" selected>Ï≤ú Îã®ÏúÑ Íµ¨Î∂Ñ</option>
      <option value="number">ÏùºÎ∞ò Ïà´Ïûê</option>
      <option value="currency">ÌÜµÌôî ÌòïÏãù</option>
      <option value="percent">Î∞±Î∂ÑÏú®</option>
      <option value="decimal">ÏÜåÏàòÏ†ê</option>
    </select>
  </div>
  <div class="number-group">
    <label>Îã®ÏúÑ Î≥ÄÌôò</label>
    <select id="unitType">
      <option value="accounting" selected>ÌöåÍ≥Ñ Îã®ÏúÑ</option>
      <option value="none">Îã®ÏúÑ ÏóÜÏùå</option>
      <option value="currency">Í∏àÏï° Îã®ÏúÑ</option>
      <option value="custom">ÏÇ¨Ïö©Ïûê Ï†ïÏùò</option>
    </select>
    <div class="unit-group">
      <input type="text" id="unitPrefix" placeholder="Ï†ëÎëêÏñ¥">
      <input type="text" id="unitSuffix" placeholder="Ï†ëÎØ∏Ïñ¥">
    </div>
  </div>
  <div class="number-group">
    <label>ÏûêÏ£º ÏÇ¨Ïö©ÌïòÎäî Îã®ÏúÑ</label>
    <div class="preset-buttons">
      <button onclick="setUnit('Ïõê')">Ïõê</button>
      <button onclick="setUnit('Ï≤úÏõê')">Ï≤úÏõê</button>
      <button onclick="setUnit('ÎßåÏõê')">ÎßåÏõê</button>
      <button onclick="setUnit('Î∞±ÎßåÏõê')">Î∞±ÎßåÏõê</button>
      <button onclick="setUnit('ÏñµÏõê')">ÏñµÏõê</button>
      <button onclick="setUnit('Í∞ú')">Í∞ú</button>
      <button onclick="setUnit('SET')">SET</button>
      <button onclick="setUnit('BOX')">BOX</button>
    </div>
  </div>
  <div class="number-group">
    <label>Îã§Ï§ë ÏÖÄ ÏûÖÎ†•</label>
    <div class="multi-input" id="multiInput">
      <div id="cellInputs"></div>
      <div class="quick-input">
        <button onclick="applySameValue()">Î™®Îëê Í∞ôÏùÄ Í∞í</button>
        <button onclick="applySequence()">ÏàúÏ∞® Ï¶ùÍ∞Ä</button>
        <button onclick="applyRandom()">ÎûúÎç§ Í∞í</button>
      </div>
    </div>
  </div>
  <div class="number-group" style="margin-top: 15px; text-align: center; border-top: 1px solid #dee2e6; padding-top: 15px;">
    <button onclick="applyNumberFormat()" style="margin-right: 5px; padding: 5px 15px; font-size: 14px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Ï†ÅÏö©</button>
    <button onclick="cancelNumberMode()" style="padding: 5px 15px; font-size: 14px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Ï∑®ÏÜå</button>
  </div>
</div>

<div class="hyperlink-panel" id="hyperlinkPanel">
  <div class="title">ÌïòÏù¥ÌçºÎßÅÌÅ¨ ÏÑ§Ï†ï</div>
  <div class="hyperlink-group">
    <div class="hyperlink-list" id="hyperlinkList">
      <div class="hyperlink-item">
        <input type="text" class="search-input" placeholder="Í≤ÄÏÉâÏñ¥ (Ï†ïÍ∑úÏãù)">
        <input type="text" class="url-input" placeholder="URL">
        <button class="remove-btn" onclick="removeHyperlinkItem(this)">√ó</button>
      </div>
    </div>
    <button class="add-btn" onclick="addHyperlinkItem()">+ Í≤ÄÏÉâÏñ¥/URL Ï∂îÍ∞Ä</button>
    <div class="current-links">
      <h4>ÌòÑÏû¨ Ï†ÅÏö©Îêú ÌïòÏù¥ÌçºÎßÅÌÅ¨</h4>
      <ul id="currentLinksList"></ul>
    </div>
  </div>
  <div class="button-group">
    <button class="apply" onclick="applyHyperlinks()">Ï†ÅÏö©</button>
    <button class="cancel" onclick="cancelHyperlinkMode()">Ï∑®ÏÜå</button>
  </div>
</div>

<div class="table-manipulation-panel" id="tableManipulationPanel">
  <div class="title">ÌÖåÏù¥Î∏î Ï°∞Ïûë</div>
  <div class="section rows">
    <div class="section-title">Ìñâ Ï°∞Ïûë</div>
    <div class="button-group">
      <button class="add" onclick="addRow()">ÏûÖÎ†• Ìñâ Ï∂îÍ∞Ä</button>
      <button class="remove" onclick="deleteRow()">ÏûÖÎ†• Ìñâ ÏÇ≠Ï†ú</button>
    </div>
  </div>
  <div class="section headers">
    <div class="section-title">Ï†úÎ™© Ìñâ Ï°∞Ïûë</div>
    <div class="button-group">
      <button class="add" onclick="addHeader()">Ï†úÎ™© Ìñâ Ï∂îÍ∞Ä</button>
      <button class="remove" onclick="deleteHeader()">Ï†úÎ™© Ìñâ ÏÇ≠Ï†ú</button>
    </div>
  </div>
  <div class="section columns">
    <div class="section-title">Ïó¥ Ï°∞Ïûë</div>
    <div class="button-group">
      <button class="add" onclick="addColumn()">Ïó¥ Ï∂îÍ∞Ä</button>
      <button class="remove" onclick="deleteColumn()">Ïó¥ ÏÇ≠Ï†ú</button>
    </div>
  </div>
  <div class="status">
    ÌòÑÏû¨ ÏÉÅÌÉú: <span id="tableStatus">Î°úÎî©Ï§ë...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="cancel" onclick="cancelTableManipulation()">Îã´Í∏∞</button>
  </div>
</div>

<div class="sum-row-panel" id="sumRowPanel">
  <div class="title">Ìï©Í≥Ñ Ìñâ Í¥ÄÎ¶¨</div>
  <div class="sum-row-list">
    <!-- Ìï©Í≥Ñ Ìñâ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê† ÏòàÏ†ï -->
  </div>
  <div class="button-group">
    <button class="add" onclick="addSumRow()">Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä</button>
    <button class="remove" onclick="removeSumRows()">Ìï©Í≥Ñ Ìñâ Ï†úÍ±∞</button>
  </div>
</div>

<div class="merge-panel" id="mergePanel">
  <div class="title">ÏÖÄ Î≥ëÌï©</div>
  <div class="section merge-mode">
    <div class="section-title">Î≥ëÌï© Î™®Îìú</div>
    <div class="button-group">
      <button class="mode" onclick="toggleMergeMode()">Î≥ëÌï© Î™®Îìú ÌôúÏÑ±Ìôî</button>
      <button class="cancel" onclick="cancelMergeMode()">Î≥ëÌï© Î™®Îìú Ï∑®ÏÜå</button>
    </div>
  </div>
  <div class="section merge-actions">
    <div class="section-title">Î≥ëÌï© ÏûëÏóÖ</div>
    <div class="button-group">
      <button class="merge" onclick="mergeCells()">ÏÑ†ÌÉù ÏÖÄ Î≥ëÌï©</button>
      <button class="undo" onclick="undoMerge()">Î≥ëÌï© ÎêòÎèåÎ¶¨Í∏∞</button>
    </div>
  </div>
  <div class="section merge-info">
    <div class="section-title">Î≥ëÌï© Ï†ïÎ≥¥</div>
    <div class="info-content">
      <p>‚Ä¢ Î≥ëÌï© Î™®ÎìúÏóêÏÑú ÏÖÄÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ ÏÑ†ÌÉùÌïú ÏÖÄÎì§ÏùÑ Î≥ëÌï©ÌïòÎ†§Î©¥ "ÏÑ†ÌÉù ÏÖÄ Î≥ëÌï©" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ Î≥ëÌï©ÏùÑ Ï∑®ÏÜåÌïòÎ†§Î©¥ "Î≥ëÌï© Î™®Îìú Ï∑®ÏÜå" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
      <p>‚Ä¢ ÎßàÏßÄÎßâ Î≥ëÌï©ÏùÑ ÎêòÎèåÎ¶¨Î†§Î©¥ "Î≥ëÌï© ÎêòÎèåÎ¶¨Í∏∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
    </div>
  </div>
  <div class="status">
    ÌòÑÏû¨ ÏÉÅÌÉú: <span id="mergeStatus">ÎåÄÍ∏∞Ï§ë...</span>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelMergeMode()">Îã´Í∏∞</button>
  </div>
</div>

<div class="row-height-panel" id="rowHeightPanel">
  <div class="title">Ìñâ ÎÜíÏù¥ Ï°∞Ï†ï</div>
  <div class="section">
    <div class="section-title">ÏûêÎèô Ï°∞Ï†ï</div>
    <div class="button-group">
      <button onclick="autoAdjustRowHeights()">Ìñâ ÎÜíÏù¥ ÏûêÎèô Ï°∞Ï†ï</button>
      <button onclick="resetRowHeights()">Ìñâ ÎÜíÏù¥ Ï¥àÍ∏∞Ìôî</button>
    </div>
  </div>
  <div class="section">
    <div class="section-title">ÏàòÎèô Ï°∞Ï†ï</div>
    <div class="row-height-control">
      <div class="row-height-display">
        <span>ÎÜíÏù¥: </span>
        <span id="currentRowHeight">24</span>
        <span>px</span>
      </div>
      <div class="row-height-slider">
        <input type="range" id="rowHeightSlider" min="24" max="200" value="24" step="1">
      </div>
      <div class="row-height-presets">
        <button onclick="setRowHeight(24)">ÏûëÍ≤å</button>
        <button onclick="setRowHeight(32)">Î≥¥ÌÜµ</button>
        <button onclick="setRowHeight(48)">ÌÅ¨Í≤å</button>
        <button onclick="setRowHeight(64)">Îß§Ïö∞ ÌÅ¨Í≤å</button>
      </div>
    </div>
  </div>
  <div class="button-group" style="margin-top: 15px; justify-content: flex-end;">
    <button class="close" onclick="cancelRowHeightPanel()">Îã´Í∏∞</button>
  </div>
</div>

<script>
// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌôïÎåÄ/Ï∂ïÏÜå ÎπÑÏú®ÏùÑ 112%Î°ú ÏÑ§Ï†ï
window.addEventListener('load', function() {
  document.body.style.zoom = "112%";
});

let undoStack = [];
let mergeMode = false;
let isSelecting = false;
let selectedCell = null;
let alignMode = false;
let styleMode = false;
let numberMode = false;

function saveState() {
  undoStack.push(document.getElementById('editableTable').innerHTML);
  if (undoStack.length > 10) undoStack.shift();
}

function undoMerge() {
  if (!undoStack.length) return alert('ÎêòÎèåÎ¶¥ ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§.');
  document.getElementById('editableTable').innerHTML = undoStack.pop();
  initSelectable();
}

function addRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  const rowCount = tbody.rows.length + 1;
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${rowCount}</td>` + '<td contenteditable="true"></td>'.repeat(8);
  tbody.appendChild(tr);
  initSelectable();
  updateTableStatus();
}

function deleteRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  if (tbody.rows.length > 1) {
    tbody.deleteRow(-1);
    updateTableStatus();
  }
}

function addHeader() {
  saveState();
  const tr = document.createElement('tr');
  for (let i = 0; i < 9; i++) {
    const th = document.createElement('th');
    th.contentEditable = 'true';
    th.style.background = '#dceeff';
    tr.appendChild(th);
  }
  document.querySelector('#editableTable thead').appendChild(tr);
  updateTableStatus();
}

function deleteHeader() {
  saveState();
  const thead = document.querySelector('#editableTable thead');
  if (thead.rows.length > 1) {
    thead.deleteRow(-1);
    updateTableStatus();
  }
}

function addColumn() {
  saveState();
  document.querySelectorAll('#editableTable tr').forEach(row => {
    const cell = row.insertCell(-1);
    cell.contentEditable = 'true';
    if (row.parentElement.tagName === 'THEAD') {
      cell.style.background = '#dceeff';
    }
  });
  initSelectable();
  updateTableStatus();
}

function deleteColumn() {
  saveState();
  document.querySelectorAll('#editableTable tr').forEach(row => {
    if (row.cells.length > 1) row.deleteCell(-1);
  });
  initSelectable();
  updateTableStatus();
}

function showModeMessage(message) {
  const messageBox = document.getElementById('modeMessage');
  messageBox.textContent = message;
  messageBox.style.display = 'block';
  setTimeout(() => {
    messageBox.style.display = 'none';
  }, 3000);
}

function toggleMergeMode() {
  mergeMode = true;
  alignMode = false;
  styleMode = false;
  clearSelection();
  document.getElementById('alignPanel').style.display = 'none';
  document.getElementById('stylePanel').style.display = 'none';
  
  // Î≥ëÌï© Ìå®ÎÑê ÌëúÏãú
  const mergePanel = document.getElementById('mergePanel');
  mergePanel.style.display = 'block';
  initMergePanelDrag();
  updateMergeStatus('Î≥ëÌï© Î™®Îìú ÌôúÏÑ±Ìôî - ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
  
  showModeMessage('Î≥ëÌï© Î™®Îìú ÌôúÏÑ±Ìôî\nÏ∑®ÏÜå Î≤ÑÌäºÏùÑ ÎàÑÎ•º ÎïåÍπåÏßÄ Í≥ÑÏÜçÌï¥ÏÑú ÏÖÄÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
}

function cancelMergeMode() {
  mergeMode = false;
  clearSelection();
  const mergePanel = document.getElementById('mergePanel');
  mergePanel.style.display = 'none';
  mergePanel.style.transform = 'translate(0, 0)';
  updateMergeStatus('ÎåÄÍ∏∞Ï§ë...');
}

function initMergePanelDrag() {
  const mergePanel = document.getElementById('mergePanel');
  const title = mergePanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, mergePanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateMergeStatus(message) {
  const status = document.getElementById('mergeStatus');
  status.textContent = message;
}

function mergeCells() {
  if (!mergeMode) {
    updateMergeStatus('Î≥ëÌï© Î™®ÎìúÎ•º Î®ºÏ†Ä ÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length < 2) {
    updateMergeStatus('Î≥ëÌï©Ìï† ÏÖÄÏùÑ 2Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
    return;
  }
  
  saveState();
  const table = document.getElementById('editableTable');
  const rows = selected.map(c => c.parentElement.rowIndex);
  const cols = selected.map(c => c.cellIndex);
  const r1 = Math.min(...rows), r2 = Math.max(...rows);
  const c1 = Math.min(...cols), c2 = Math.max(...cols);
  
  // Î≥ëÌï© ÏûëÏóÖ ÏàòÌñâ
  const master = table.rows[r1].cells[c1];
  let combined = master.innerHTML;
  for (let i = r1; i <= r2; i++) {
    for (let j = c1; j <= c2; j++) {
      if (i === r1 && j === c1) continue;
      combined += '<br>' + table.rows[i].cells[j]?.innerHTML;
    }
  }
  
  // Î≥ëÌï© Ï†ÅÏö©
  master.innerHTML = combined;
  master.rowSpan = r2 - r1 + 1;
  master.colSpan = c2 - c1 + 1;
  
  // Ïä§ÌÉÄÏùº Ï†ÅÏö©
  master.style.height = 'auto';
  master.style.minHeight = '40px';
  master.style.whiteSpace = 'pre-wrap';
  master.style.verticalAlign = 'middle';
  
  // ÎÜíÏù¥ ÏûêÎèô Ï°∞Ï†ï
  const contentHeight = master.scrollHeight;
  if (contentHeight > 40) {
    master.style.height = contentHeight + 'px';
  }
  
  // Ìé∏Ïßë Í∞ÄÎä• ÏÑ§Ï†ï
  master.contentEditable = 'true';
  
  // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
  master.onmousedown = e => {
    if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
    e.preventDefault();
    if (!isSelecting) {
      saveState();
      isSelecting = true;
    }
    master.classList.add('selected');
    if (numberMode) {
      updateMultiInput();
    }
  };
  
  master.onmouseover = e => {
    if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
      e.target.classList.add('selected');
      if (numberMode) {
        updateMultiInput();
      }
    }
  };
  
  master.onmouseup = () => {
    isSelecting = false;
  };
  
  // ÎÇ¥Ïö© Î≥ÄÍ≤Ω Ïãú ÎÜíÏù¥ ÏûêÎèô Ï°∞Ï†ï
  master.addEventListener('input', function() {
    this.style.height = 'auto';
    const newHeight = this.scrollHeight;
    if (newHeight > 40) {
      this.style.height = newHeight + 'px';
    }
    
    const rowSpan = parseInt(this.getAttribute('rowspan')) || 1;
    const rowHeight = Math.ceil(newHeight / rowSpan);
    for (let i = 0; i < rowSpan; i++) {
      const row = table.rows[r1 + i];
      if (row) {
        row.style.height = rowHeight + 'px';
      }
    }
  });
  
  // Î≥ëÌï©Îêú ÏÖÄ Ï†úÍ±∞
  for (let i = r2; i >= r1; i--) {
    for (let j = c2; j >= c1; j--) {
      if (i === r1 && j === c1) continue;
      table.rows[i].deleteCell(j);
    }
  }
  
  mergeMode = false;
  clearSelection();
  updateMergeStatus('ÏÖÄ Î≥ëÌï© ÏôÑÎ£å');
  
  // 3Ï¥à ÌõÑ ÏÉÅÌÉú Î©îÏãúÏßÄ Ï¥àÍ∏∞Ìôî
  setTimeout(() => {
    updateMergeStatus('ÎåÄÍ∏∞Ï§ë...');
  }, 3000);
}

function toggleAlignMode() {
  alignMode = true;
  mergeMode = false;
  styleMode = false;
  clearSelection();
  const alignPanel = document.getElementById('alignPanel');
  alignPanel.style.display = 'block';
  initAlignPanelDrag();
  updateAlignStatus('Ï†ïÎ†¨ Î™®Îìú ÌôúÏÑ±Ìôî - ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
  showModeMessage('Ï†ïÎ†¨ Î™®Îìú ÌôúÏÑ±Ìôî\nÏ∑®ÏÜå Î≤ÑÌäºÏùÑ ÎàÑÎ•º ÎïåÍπåÏßÄ Í≥ÑÏÜçÌï¥ÏÑú ÏÖÄÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
}

function cancelAlignMode() {
  alignMode = false;
  clearSelection();
  const alignPanel = document.getElementById('alignPanel');
  alignPanel.style.display = 'none';
  alignPanel.style.transform = 'translate(0, 0)';
  updateAlignStatus('ÎåÄÍ∏∞Ï§ë...');
}

function initAlignPanelDrag() {
  const alignPanel = document.getElementById('alignPanel');
  const title = alignPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, alignPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateAlignStatus(message) {
  const status = document.getElementById('alignStatus');
  status.textContent = message;
}

function applyAlignment(align) {
  if (!alignMode) {
    updateAlignStatus('Ï†ïÎ†¨ Î™®ÎìúÎ•º Î®ºÏ†Ä ÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) {
    updateAlignStatus('Ï†ïÎ†¨Ìï† ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
    return;
  }
  
  selected.forEach(cell => cell.style.textAlign = align);
  alignMode = false;
  clearSelection();
  updateAlignStatus('Ï†ïÎ†¨ Ï†ÅÏö© ÏôÑÎ£å');
  
  // 3Ï¥à ÌõÑ ÏÉÅÌÉú Î©îÏãúÏßÄ Ï¥àÍ∏∞Ìôî
  setTimeout(() => {
    updateAlignStatus('ÎåÄÍ∏∞Ï§ë...');
  }, 3000);
}

function toggleStyleMode() {
  styleMode = true;
  mergeMode = false;
  alignMode = false;
  clearSelection();
  const stylePanel = document.getElementById('stylePanel');
  stylePanel.style.display = 'block';
  initStylePanelDrag();
  updateStyleStatus('Ïä§ÌÉÄÏùº Î™®Îìú ÌôúÏÑ±Ìôî - ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
  showModeMessage('Ïä§ÌÉÄÏùº Î™®Îìú ÌôúÏÑ±Ìôî\nÏ∑®ÏÜå Î≤ÑÌäºÏùÑ ÎàÑÎ•º ÎïåÍπåÏßÄ Í≥ÑÏÜçÌï¥ÏÑú ÏÖÄÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
}

function cancelStyleMode() {
  styleMode = false;
  clearSelection();
  const stylePanel = document.getElementById('stylePanel');
  stylePanel.style.display = 'none';
  stylePanel.style.transform = 'translate(0, 0)';
  updateStyleStatus('ÎåÄÍ∏∞Ï§ë...');
}

function initStylePanelDrag() {
  const stylePanel = document.getElementById('stylePanel');
  const title = stylePanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;

    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;

      xOffset = currentX;
      yOffset = currentY;

      setTranslate(currentX, currentY, stylePanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateStyleStatus(message) {
  const status = document.getElementById('styleStatus');
  status.textContent = message;
}

function applyStyle() {
  if (!styleMode) {
    updateStyleStatus('Ïä§ÌÉÄÏùº Î™®ÎìúÎ•º Î®ºÏ†Ä ÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) {
    updateStyleStatus('Ïä§ÌÉÄÏùºÏùÑ Ï†ÅÏö©Ìï† ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
    return;
  }
  
  const fontSize = document.getElementById('fontSize').value;
  const isBold = document.getElementById('fontBold').checked;
  const fontColor = document.getElementById('fontColor').value;
  
  selected.forEach(cell => {
    cell.style.fontSize = fontSize + 'px';
    cell.style.fontWeight = isBold ? 'bold' : 'normal';
    cell.style.color = fontColor;
  });
  
  styleMode = false;
  clearSelection();
  updateStyleStatus('Ïä§ÌÉÄÏùº Ï†ÅÏö© ÏôÑÎ£å');
  
  // 3Ï¥à ÌõÑ ÏÉÅÌÉú Î©îÏãúÏßÄ Ï¥àÍ∏∞Ìôî
  setTimeout(() => {
    updateStyleStatus('ÎåÄÍ∏∞Ï§ë...');
  }, 3000);
}

function initSelectable() {
  clearSelection();
  document.querySelectorAll('#editableTable td, #editableTable th').forEach(cell => {
    // Ïù¥ÎØ∏ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ Ï†úÍ±∞
    const newCell = cell.cloneNode(true);
    cell.parentNode.replaceChild(newCell, cell);
    
    // contentEditable ÏÜçÏÑ±Ïù¥ ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå input Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
    if (newCell.contentEditable === 'true') {
      newCell.addEventListener('input', function() {
        adjustCellHeight(this);
      });
    }
    
    newCell.onmousedown = e => {
      if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
      e.preventDefault();
      if (!isSelecting) {
        saveState();
        isSelecting = true;
      }
      newCell.classList.add('selected');
      if (numberMode) {
        updateMultiInput();
      }
    };
    newCell.onmouseover = e => {
      if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
        e.target.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      }
    };
    newCell.onmouseup = () => {
      isSelecting = false;
    };
  });
  document.body.onmouseup = () => (isSelecting = false);
}

function clearSelection() {
  document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
}

function toggleHyperlinkMode() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  hyperlinkPanel.style.display = 'block';
  initHyperlinkPanelDrag();
  updateCurrentLinksList(); // ÌòÑÏû¨ ÎßÅÌÅ¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
}

function cancelHyperlinkMode() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  hyperlinkPanel.style.display = 'none';
  hyperlinkPanel.style.transform = 'translate(0, 0)';
}

function initHyperlinkPanelDrag() {
  const hyperlinkPanel = document.getElementById('hyperlinkPanel');
  const title = hyperlinkPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, hyperlinkPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function addHyperlinkItem() {
  const list = document.getElementById('hyperlinkList');
  const item = document.createElement('div');
  item.className = 'hyperlink-item';
  item.innerHTML = `
    <input type="text" class="search-input" placeholder="Í≤ÄÏÉâÏñ¥ (Ï†ïÍ∑úÏãù)">
    <input type="text" class="url-input" placeholder="URL">
    <button class="remove-btn" onclick="removeHyperlinkItem(this)">√ó</button>
  `;
  list.appendChild(item);
}

function removeHyperlinkItem(button) {
  const item = button.parentElement;
  if (document.querySelectorAll('.hyperlink-item').length > 1) {
    item.remove();
  } else {
    // ÎßàÏßÄÎßâ Ìï≠Î™©ÏùÄ ÎπÑÏö∞Í∏∞Îßå Ìï®
    item.querySelectorAll('input').forEach(input => input.value = '');
  }
}

function updateCurrentLinksList() {
  const list = document.getElementById('currentLinksList');
  list.innerHTML = '';
  
  // ÌòÑÏû¨ ÌÖåÏù¥Î∏îÏùò Î™®Îì† ÌïòÏù¥ÌçºÎßÅÌÅ¨ ÏàòÏßë
  const linkMap = new Map();
  document.querySelectorAll('#editableTable a').forEach(a => {
    const url = a.href;
    const text = a.textContent;
    if (!linkMap.has(url)) {
      linkMap.set(url, new Set());
    }
    linkMap.get(url).add(text);
  });
  
  // ÎßÅÌÅ¨ Î™©Î°ù ÌëúÏãú
  linkMap.forEach((texts, url) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <span>${url}</span>
      <span class="link-count">(${texts.size}Í∞ú ÌÖçÏä§Ìä∏)</span>
    `;
    list.appendChild(li);
  });
  
  if (linkMap.size === 0) {
    const li = document.createElement('li');
    li.textContent = 'Ï†ÅÏö©Îêú ÌïòÏù¥ÌçºÎßÅÌÅ¨Í∞Ä ÏóÜÏäµÎãàÎã§.';
    list.appendChild(li);
  }
}

function applyHyperlinks() {
  const items = document.querySelectorAll('.hyperlink-item');
  const validItems = [];
  
  // Ïú†Ìö®Ìïú ÏûÖÎ†• Ìï≠Î™© ÏàòÏßë
  items.forEach(item => {
    const searchInput = item.querySelector('.search-input');
    const urlInput = item.querySelector('.url-input');
    const pattern = searchInput.value.trim();
    const url = urlInput.value.trim();
    
    if (pattern && url) {
      try {
        new RegExp(pattern); // Ï†ïÍ∑úÏãù Í≤ÄÏ¶ù
        validItems.push({ pattern, url });
      } catch (e) {
        alert(`Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ï†ïÍ∑úÏãùÏûÖÎãàÎã§: ${pattern}`);
        return;
      }
    }
  });
  
  if (validItems.length === 0) {
    alert('ÏµúÏÜå ÌïòÎÇò Ïù¥ÏÉÅÏùò Í≤ÄÏÉâÏñ¥ÏôÄ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
    return;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  const targetCells = selected.length > 0 ? selected : document.querySelectorAll('#editableTable tbody td');
  
  targetCells.forEach(td => {
    let content = td.innerHTML;
    validItems.forEach(({ pattern, url }) => {
      try {
        const regex = new RegExp(pattern, 'g');
        content = content.replace(regex, match => 
          `<a href="${url}" target="_blank" contenteditable="false">${match}</a>`
        );
      } catch (e) {
        console.error(`Ï†ïÍ∑úÏãù Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò Î∞úÏÉù: ${pattern}`, e);
      }
    });
    td.innerHTML = content;
  });
  
  updateCurrentLinksList(); // ÎßÅÌÅ¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
  cancelHyperlinkMode();
}

async function downloadHTML() {
  try {
    // ÌòÑÏû¨ ÌÖåÏù¥Î∏î ÏÉÅÌÉú Î≥µÏ†ú
    const tableClone = document.getElementById('editableTable').cloneNode(true);
    
    // NO. Ïó¥Ïùò ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
    const noColumn = tableClone.querySelector('th:first-child');
    if (noColumn) {
      noColumn.style.width = 'auto';
      noColumn.style.minWidth = 'auto';
      noColumn.style.whiteSpace = 'nowrap';
    }
    
    // Î™®Îì† ÏÖÄÏùò ÌòÑÏû¨ ÏÉÅÌÉú Î≥¥Ï°¥
    const cells = tableClone.querySelectorAll('td, th');
    cells.forEach(cell => {
      // Ïä§ÌÉÄÏùº Ï†ïÎ≥¥ Î≥¥Ï°¥
      const computedStyle = window.getComputedStyle(cell);
      cell.style.cssText = computedStyle.cssText;
      
      // Îç∞Ïù¥ÌÑ∞ ÏÜçÏÑ± Î≥¥Ï°¥
      const dataAttributes = cell.attributes;
      for (let i = 0; i < dataAttributes.length; i++) {
        const attr = dataAttributes[i];
        if (attr.name.startsWith('data-')) {
          cell.setAttribute(attr.name, attr.value);
        }
      }
      
      // Î≥ëÌï© ÏÉÅÌÉú Î≥¥Ï°¥
      if (cell.hasAttribute('rowspan')) {
        cell.setAttribute('rowspan', cell.getAttribute('rowspan'));
      }
      if (cell.hasAttribute('colspan')) {
        cell.setAttribute('colspan', cell.getAttribute('colspan'));
      }
      
      // contentEditable ÏÜçÏÑ± Ï†úÍ±∞
      cell.removeAttribute('contenteditable');
      
      // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
      cell.onmousedown = null;
      cell.onmouseover = null;
      cell.onmouseup = null;
      
      // ÌïòÏù¥ÌçºÎßÅÌÅ¨ Î≥¥Ï°¥
      const links = cell.querySelectorAll('a');
      links.forEach(link => {
        link.removeAttribute('contenteditable');
        link.style.pointerEvents = 'auto';
      });
    });

    // HTML ÏÉùÏÑ±
    const html = '<!DOCTYPE html>' + document.documentElement.outerHTML;
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    
    // ÏõêÎ≥∏ ÌÖåÏù¥Î∏îÏùÑ ÏàòÏ†ïÎêú ÌÖåÏù¥Î∏îÎ°ú ÍµêÏ≤¥
    const originalTable = tempDiv.querySelector('#editableTable');
    originalTable.parentNode.replaceChild(tableClone, originalTable);
    
    // Ïª®Ìä∏Î°§ Ìå®ÎÑê Î∞è Î∂àÌïÑÏöîÌïú ÏöîÏÜå Ï†úÍ±∞
    const elementsToRemove = [
      '.controls',
      '.style-panel',
      '.align-panel',
      '.number-panel',
      '.hyperlink-panel',
      '.table-manipulation-panel',
      '.sum-row-panel',
      '.merge-panel',
      '.edit-mode-button',
      '.mode-message'
    ];
    
    elementsToRemove.forEach(selector => {
      const element = tempDiv.querySelector(selector);
      if (element) element.remove();
    });
    
    // ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº ÏµúÏ†ÅÌôî
    const table = tempDiv.querySelector('#editableTable');
    if (table) {
      table.style.width = '100%';
      table.style.margin = '0 auto';
      table.style.borderCollapse = 'collapse';
      table.style.tableLayout = 'auto';
    }
    
    const finalHtml = '<!DOCTYPE html>' + tempDiv.innerHTML;
    const blob = new Blob(['Ôªø' + finalHtml], { type: 'text/html' });
    
    // ÌòÑÏû¨ ÎÇ†ÏßúÎ•º YYMMDD ÌòïÏãùÏúºÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
    const now = new Date();
    const year = now.getFullYear().toString().slice(-2);
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const day = now.getDate().toString().padStart(2, '0');
    const dateStr = `${year}${month}${day}`;
    
    // ÌååÏùºÎ™Ö ÏÉùÏÑ±
    const defaultFileName = `ÌòëÏùò_ÏïàÍ±¥_Î™©Î°ù_${dateStr}.html`;

    // ÌååÏùº Ï†ÄÏû• Îã§Ïù¥ÏñºÎ°úÍ∑∏ ÌëúÏãú
    const handle = await window.showSaveFilePicker({
      suggestedName: defaultFileName,
      types: [{
        description: 'HTML ÌååÏùº',
        accept: {'text/html': ['.html']},
      }],
    });

    // ÌååÏùº Ï†ÄÏû•
    const writable = await handle.createWritable();
    await writable.write(blob);
    await writable.close();

    alert('ÌååÏùºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
  } catch (err) {
    if (err.name !== 'AbortError') {
      console.error('ÌååÏùº Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:', err);
      alert('ÌååÏùº Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
  }
}

function toggleFullscreen() {
  document.body.classList.toggle('fullscreen-mode');
}

function setFontSize(size) {
  document.getElementById('fontSize').value = size;
  if (selectedCell && styleMode) {
    selectedCell.style.fontSize = size + 'px';
  }
}

function setFontColor(color) {
  document.getElementById('fontColor').value = color;
  if (selectedCell && styleMode) {
    selectedCell.style.color = color;
  }
}

function toggleNumberMode() {
  numberMode = true;
  mergeMode = false;
  alignMode = false;
  styleMode = false;
  clearSelection();
  const numberPanel = document.getElementById('numberPanel');
  numberPanel.style.display = 'block';
  document.getElementById('alignPanel').style.display = 'none';
  document.getElementById('stylePanel').style.display = 'none';
  showModeMessage('Ïà´Ïûê ÏûÖÎ†• Î™®Îìú ÌôúÏÑ±Ìôî\nÏ∑®ÏÜå Î≤ÑÌäºÏùÑ ÎàÑÎ•º ÎïåÍπåÏßÄ Í≥ÑÏÜçÌï¥ÏÑú ÏÖÄÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
  initNumberPanelDrag();
}

function cancelNumberMode() {
  numberMode = false;
  clearSelection();
  const numberPanel = document.getElementById('numberPanel');
  numberPanel.style.display = 'none';
  numberPanel.style.transform = 'translate(0, 0)';
}

function initNumberPanelDrag() {
  const numberPanel = document.getElementById('numberPanel');
  const title = numberPanel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, numberPanel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function setUnit(unit) {
  document.getElementById('unitSuffix').value = unit;
}

function updateMultiInput() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  const multiInput = document.getElementById('multiInput');
  const cellInputs = document.getElementById('cellInputs');
  
  if (selected.length > 1) {
    multiInput.classList.add('active');
    cellInputs.innerHTML = '';
    
    selected.forEach((cell, index) => {
      const cellInput = document.createElement('div');
      cellInput.className = 'cell-input';
      
      // ÌòÑÏû¨ ÏÖÄÏùò Í∞íÏùÑ Í∞ÄÏ†∏Ïò¥
      let currentValue = cell.textContent.trim();
      // Ïà´ÏûêÍ∞Ä ÏïÑÎãå Î¨∏Ïûê Ï†úÍ±∞ (Îã®ÏúÑ Îì±)
      currentValue = currentValue.replace(/[^0-9.-]/g, '');
      // Ïà´ÏûêÎ°ú Î≥ÄÌôò
      let numValue = parseFloat(currentValue);
      if (isNaN(numValue)) {
        numValue = 0;
      }
      
      cellInput.innerHTML = `
        <label>ÏÖÄ ${index + 1}</label>
        <input type="number" 
               data-cell-index="${index}" 
               value="${numValue}" 
               onchange="updateCellValue(this)">
      `;
      cellInputs.appendChild(cellInput);
    });
  } else {
    multiInput.classList.remove('active');
  }
}

function updateCellValue(input) {
  const selected = Array.from(document.querySelectorAll('.selected'));
  const index = parseInt(input.dataset.cellIndex);
  if (selected[index]) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    // ÏûÖÎ†•Í∞íÏùÑ Ïà´ÏûêÎ°ú Î≥ÄÌôò
    let numValue = parseFloat(input.value);
    if (isNaN(numValue)) {
      numValue = 0;
    }
    
    // ÌòïÏãù Ï†ÅÏö©
    selected[index].textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    selected[index].style.textAlign = 'right';
  }
}

function applySameValue() {
  const value = prompt('Î™®Îì† ÏÖÄÏóê Ï†ÅÏö©Ìï† Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
  if (value === null) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  // ÏûÖÎ†•Í∞íÏùÑ Ïà´ÏûêÎ°ú Î≥ÄÌôò
  let numValue = parseFloat(value);
  if (isNaN(numValue)) {
    numValue = 0;
  }
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach(cell => {
    cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function applySequence() {
  const start = parseInt(prompt('ÏãúÏûë Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:'));
  if (isNaN(start)) return;
  
  const step = parseInt(prompt('Ï¶ùÍ∞Ä Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:'));
  if (isNaN(step)) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach((cell, index) => {
    const value = start + (index * step);
    cell.textContent = formatNumber(value, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function applyRandom() {
  const min = parseInt(prompt('ÏµúÏÜå Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:'));
  if (isNaN(min)) return;
  
  const max = parseInt(prompt('ÏµúÎåÄ Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:'));
  if (isNaN(max)) return;
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  
  const selected = Array.from(document.querySelectorAll('.selected'));
  selected.forEach(cell => {
    const value = Math.floor(Math.random() * (max - min + 1)) + min;
    cell.textContent = formatNumber(value, format, unitType, prefix, suffix);
    cell.style.textAlign = 'right';
  });
  updateMultiInput();
}

function formatNumber(value, format, unitType, prefix, suffix) {
  if (!value && value !== 0) return '';
  
  let num = parseFloat(value);
  if (isNaN(num)) return value;

  let formattedNum;
  switch (format) {
    case 'thousand':
      formattedNum = num.toLocaleString('ko-KR');
      break;
    case 'currency':
      formattedNum = num.toLocaleString('ko-KR', {
        style: 'currency',
        currency: 'KRW',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      });
      break;
    case 'percent':
      formattedNum = (num * 100).toLocaleString('ko-KR') + '%';
      break;
    case 'decimal':
      formattedNum = num.toLocaleString('ko-KR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
      break;
    default:
      formattedNum = num.toLocaleString('ko-KR');
  }

  // Îã®ÏúÑ ÌÉÄÏûÖÏóê Îî∞Î•∏ Ï∂îÍ∞Ä Ìè¨Îß∑ÌåÖ
  if (unitType === 'accounting') {
    if (suffix) {
      formattedNum = formattedNum.replace(/[^0-9,]/g, '') + suffix;
    }
  } else if (unitType === 'currency') {
    if (prefix) {
      formattedNum = prefix + formattedNum.replace(/[^0-9,]/g, '');
    }
    if (suffix) {
      formattedNum = formattedNum + suffix;
    }
  }

  return formattedNum;
}

function applyNumberFormat() {
  if (!numberMode) return alert('Ïà´Ïûê ÏûÖÎ†• Î™®ÎìúÎ•º ÌôúÏÑ±ÌôîÌïòÏÑ∏Ïöî.');
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length === 0) return alert('Ïà´Ïûê ÌòïÏãùÏùÑ Ï†ÅÏö©Ìï† ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
  
  const format = document.getElementById('numberFormat').value;
  const unitType = document.getElementById('unitType').value;
  const prefix = document.getElementById('unitPrefix').value;
  const suffix = document.getElementById('unitSuffix').value;
  const minValue = document.getElementById('minValue').value;
  const maxValue = document.getElementById('maxValue').value;
  
  // ÏÑ†ÌÉùÎêú ÏÖÄÎì§Ïùò Ïó¥ Ïù∏Îç±Ïä§ Ï∂îÏ∂ú
  const selectedColumns = new Set(selected.map(cell => cell.cellIndex));
  
  selected.forEach(cell => {
    // ÌòÑÏû¨ ÏÖÄÏùò Í∞íÏùÑ Í∞ÄÏ†∏Ïò¥
    let currentValue = cell.textContent.trim();
    
    // Ïà´ÏûêÍ∞Ä ÏïÑÎãå Î¨∏Ïûê Ï†úÍ±∞ (Îã®ÏúÑ Îì±)
    currentValue = currentValue.replace(/[^0-9.-]/g, '');
    
    // Ïà´ÏûêÎ°ú Î≥ÄÌôò
    let numValue = parseFloat(currentValue);
    if (isNaN(numValue)) {
      numValue = 0;
    }
    
    // Î≤îÏúÑ Ï≤¥ÌÅ¨
    if (minValue && numValue < parseFloat(minValue)) {
      numValue = parseFloat(minValue);
    }
    if (maxValue && numValue > parseFloat(maxValue)) {
      numValue = parseFloat(maxValue);
    }
    
    // ÌòïÏãù Ï†ÅÏö©
    cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
    
    // Îç∞Ïù¥ÌÑ∞ ÏÜçÏÑ± Ï†ÄÏû•
    cell.setAttribute('data-number-format', format);
    cell.setAttribute('data-unit-type', unitType);
    cell.setAttribute('data-unit-prefix', prefix);
    cell.setAttribute('data-unit-suffix', suffix);
    cell.setAttribute('data-min-value', minValue);
    cell.setAttribute('data-max-value', maxValue);
    
    // Ïö∞Ï∏° Ï†ïÎ†¨ Ï†ÅÏö©
    cell.style.textAlign = 'right';
  });
  
  // ÏÑ†ÌÉùÎêú Ïó¥Ïùò ÏûêÎèô Ïó¥Ìè≠ Ï°∞Ï†ï
  adjustColumnWidths(selectedColumns);
  
  numberMode = false;
  clearSelection();
  document.getElementById('numberPanel').style.display = 'none';
}

function adjustColumnWidths(selectedColumns) {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // Í∞Å ÏÑ†ÌÉùÎêú Ïó¥Ïóê ÎåÄÌï¥
  selectedColumns.forEach(colIndex => {
    let maxWidth = 0;
    const padding = 20; // ÏÖÄ Ìå®Îî© Í≥†Î†§
    
    // Ìï¥Îãπ Ïó¥Ïùò Î™®Îì† ÏÖÄÏùÑ Í≤ÄÏÇ¨ÌïòÏó¨ ÏµúÎåÄ ÎÑàÎπÑ Í≥ÑÏÇ∞
    for (let i = 0; i < rows.length; i++) {
      const cell = rows[i].cells[colIndex];
      if (cell) {
        // ÏûÑÏãú span ÏöîÏÜåÎ•º ÏÉùÏÑ±ÌïòÏó¨ Ïã§Ï†ú ÌÖçÏä§Ìä∏ ÎÑàÎπÑ Ï∏°Ï†ï
        const span = document.createElement('span');
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'nowrap';
        span.style.font = window.getComputedStyle(cell).font;
        span.textContent = cell.textContent;
        document.body.appendChild(span);
        
        const width = span.offsetWidth + padding;
        maxWidth = Math.max(maxWidth, width);
        
        document.body.removeChild(span);
      }
    }
    
    // ÏµúÏÜå ÎÑàÎπÑ ÏÑ§Ï†ï (ÏµúÏÜå 100px)
    maxWidth = Math.max(maxWidth, 100);
    
    // Ìï¥Îãπ Ïó¥Ïùò Î™®Îì† ÏÖÄÏóê ÎÑàÎπÑ Ï†ÅÏö©
    for (let i = 0; i < rows.length; i++) {
      const cell = rows[i].cells[colIndex];
      if (cell) {
        cell.style.width = maxWidth + 'px';
        cell.style.minWidth = maxWidth + 'px';
      }
    }
  });
}

// Ïà´Ïûê ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
document.getElementById('numberFormat').addEventListener('change', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = this.value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitType').addEventListener('change', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = this.value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitPrefix').addEventListener('input', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = this.value;
    const suffix = document.getElementById('unitSuffix').value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

document.getElementById('unitSuffix').addEventListener('input', function() {
  const selected = Array.from(document.querySelectorAll('.selected'));
  if (selected.length > 0) {
    const format = document.getElementById('numberFormat').value;
    const unitType = document.getElementById('unitType').value;
    const prefix = document.getElementById('unitPrefix').value;
    const suffix = this.value;
    
    selected.forEach(cell => {
      let currentValue = cell.textContent.trim().replace(/[^0-9.-]/g, '');
      let numValue = parseFloat(currentValue);
      if (!isNaN(numValue)) {
        cell.textContent = formatNumber(numValue, format, unitType, prefix, suffix);
        cell.style.textAlign = 'right';
      }
    });
  }
});

function removeSumRows() {
  const tbody = document.getElementById('tbody');
  const sumRows = Array.from(tbody.rows).filter(row => row.cells[0].textContent === 'Ìï©Í≥Ñ');
  
  if (sumRows.length === 0) {
    alert('Ï†úÍ±∞Ìï† Ìï©Í≥Ñ ÌñâÏù¥ ÏóÜÏäµÎãàÎã§.');
    return;
  }
  
  // Í∞ÄÏû• ÎßàÏßÄÎßâ Ìï©Í≥Ñ ÌñâÎßå Ï†úÍ±∞
  const lastSumRow = sumRows[sumRows.length - 1];
  lastSumRow.remove();
}

function addSumRow() {
  saveState();
  const tbody = document.getElementById('tbody');
  const rows = tbody.rows;
  
  // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ Ìñâ Ï∞æÍ∏∞
  let firstSumRow = null;
  for (let i = 0; i < rows.length; i++) {
    if (rows[i].cells[0].textContent === 'Ìï©Í≥Ñ') {
      firstSumRow = rows[i];
      break;
    }
  }
  
  let newRow;
  if (firstSumRow) {
    // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ ÌñâÏù¥ ÏûàÏúºÎ©¥ Í∑∏Í≤ÉÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Î≥µÏÇ¨
    newRow = document.createElement('tr');
    // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ ÌñâÏùò ÏÖÄ ÏàòÎßåÌÅº Îπà ÏÖÄ ÏÉùÏÑ±
    for (let i = 0; i < firstSumRow.cells.length; i++) {
      const newCell = document.createElement('td');
      newCell.style.backgroundColor = '#DAF2D0';
      // Î™®Îìú Ï†ÅÏö©ÏùÑ ÏúÑÌïú ÏÜçÏÑ± Ï∂îÍ∞Ä
      newCell.contentEditable = 'true';
      newCell.onmousedown = e => {
        if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
        e.preventDefault();
        if (!isSelecting) {
          saveState();
          isSelecting = true;
        }
        newCell.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      };
      newCell.onmouseover = e => {
        if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
          e.target.classList.add('selected');
          if (numberMode) {
            updateMultiInput();
          }
        }
      };
      newCell.onmouseup = () => {
        isSelecting = false;
      };
      newRow.appendChild(newCell);
    }
  } else {
    // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ ÌñâÏù¥ ÏóÜÏúºÎ©¥ ÎßàÏßÄÎßâ ÌñâÏùÑ Î≥µÏÇ¨
    const lastRow = rows[rows.length - 1];
    newRow = lastRow.cloneNode(true);
    // Î∞∞Í≤ΩÏÉâ Ï†ÅÏö©
    Array.from(newRow.cells).forEach(cell => {
      cell.style.backgroundColor = '#DAF2D0';
      // Î™®Îìú Ï†ÅÏö©ÏùÑ ÏúÑÌïú ÏÜçÏÑ± Ï∂îÍ∞Ä
      cell.contentEditable = 'true';
      cell.onmousedown = e => {
        if (!mergeMode && !alignMode && !styleMode && !numberMode) return;
        e.preventDefault();
        if (!isSelecting) {
          saveState();
          isSelecting = true;
        }
        cell.classList.add('selected');
        if (numberMode) {
          updateMultiInput();
        }
      };
      cell.onmouseover = e => {
        if ((mergeMode || alignMode || styleMode || numberMode) && isSelecting) {
          e.target.classList.add('selected');
          if (numberMode) {
            updateMultiInput();
          }
        }
      };
      cell.onmouseup = () => {
        isSelecting = false;
      };
    });
  }
  
  // Í∞Å Ïó¥Ïùò Ìï©Í≥Ñ Í≥ÑÏÇ∞
  const table = document.getElementById('editableTable');
  
  for (let colIndex = 0; colIndex < newRow.cells.length; colIndex++) {
    let sum = 0;
    let hasNumbers = false;
    let numberFormat = '';
    let unitType = '';
    let unitPrefix = '';
    let unitSuffix = '';
    let originalFormat = null;
    
    // Ìï¥Îãπ Ïó¥Ïùò Î™®Îì† ÌñâÏùÑ Í≤ÄÏÇ¨ (Ìï©Í≥Ñ Ìñâ Ï†úÏô∏)
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell && rows[rowIndex].cells[0].textContent !== 'Ìï©Í≥Ñ') {
        // Ïà´Ïûê ÌòïÏãù Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        if (rowIndex === 0) {
          numberFormat = cell.getAttribute('data-number-format') || '';
          unitType = cell.getAttribute('data-unit-type') || '';
          unitPrefix = cell.getAttribute('data-unit-prefix') || '';
          unitSuffix = cell.getAttribute('data-unit-suffix') || '';
        }
        
        // Ïà´Ïûê Í∞í Ï∂îÏ∂ú Î∞è Ìï©ÏÇ∞
        const value = cell.textContent.trim();
        // Ïà´ÏûêÍ∞Ä ÏïÑÎãå Î¨∏Ïûê Ï†úÍ±∞ (Îã®ÏúÑ Îì±)
        const numValue = parseFloat(value.replace(/[^0-9.-]/g, ''));
        if (!isNaN(numValue)) {
          sum += numValue;
          hasNumbers = true;
          // ÏõêÎ≥∏ Ìè¨Îß∑ Ï†ÄÏû•
          if (!originalFormat && value !== numValue.toString()) {
            originalFormat = value;
          }
        }
      }
    }
    
    // Ìï©Í≥Ñ Ï†ÅÏö©
    if (hasNumbers) {
      let formattedSum;
      if (originalFormat) {
        // ÏõêÎ≥∏ Ìè¨Îß∑Ïù¥ ÏûàÎäî Í≤ΩÏö∞ Ìï¥Îãπ Ìè¨Îß∑ Ïú†ÏßÄ
        formattedSum = originalFormat.replace(/[0-9,.-]+/g, sum.toLocaleString('ko-KR'));
      } else {
        // ÏõêÎ≥∏ Ìè¨Îß∑Ïù¥ ÏóÜÎäî Í≤ΩÏö∞ Í∏∞Î≥∏ Ìè¨Îß∑ Ï†ÅÏö©
        formattedSum = formatNumber(sum, numberFormat, unitType, unitPrefix, unitSuffix);
      }
      newRow.cells[colIndex].textContent = formattedSum;
      newRow.cells[colIndex].style.fontWeight = 'bold';
      newRow.cells[colIndex].style.textAlign = 'right';
    }
  }
  
  // NO.ÏôÄ Ìï≠Î™© ÏÖÄ Î≥ëÌï©
  if (firstSumRow) {
    // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ ÌñâÏù¥ ÏûàÎäî Í≤ΩÏö∞, ÎèôÏùºÌïú Íµ¨Ï°∞Î°ú Î≥ëÌï©
    newRow.cells[0].colSpan = firstSumRow.cells[0].colSpan;
    // Î≥ëÌï©Îêú ÏÖÄ Ïù¥ÌõÑÏùò ÏÖÄÎì§ Ï†úÍ±∞
    for (let i = newRow.cells.length - 1; i >= firstSumRow.cells.length; i--) {
      newRow.deleteCell(i);
    }
  } else {
    // Ï≤´ Î≤àÏß∏ Ìï©Í≥Ñ ÌñâÏù¥ ÏóÜÎäî Í≤ΩÏö∞, Í∏∞Ï°¥ Î∞©ÏãùÎåÄÎ°ú Î≥ëÌï©
    newRow.cells[0].colSpan = 2;
    newRow.cells[1].remove();
  }
  
  newRow.cells[0].textContent = 'Ìï©Í≥Ñ';
  newRow.cells[0].style.fontWeight = 'bold';
  newRow.cells[0].style.textAlign = 'center';
  
  // ÏÉà Ìñâ Ï∂îÍ∞Ä
  tbody.appendChild(newRow);
  
  // Î™®Îìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïû¨ÏÑ§Ï†ï
  initSelectable();
}

function toggleTableManipulation() {
  const panel = document.getElementById('tableManipulationPanel');
  panel.style.display = 'block';
  initTableManipulationPanelDrag();
  updateTableStatus();
}

function cancelTableManipulation() {
  const panel = document.getElementById('tableManipulationPanel');
  panel.style.display = 'none';
  panel.style.transform = 'translate(0, 0)';
}

function initTableManipulationPanelDrag() {
  const panel = document.getElementById('tableManipulationPanel');
  const title = panel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, panel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

function updateTableStatus() {
  const tbody = document.getElementById('tbody');
  const thead = document.querySelector('#editableTable thead');
  const status = document.getElementById('tableStatus');
  
  const rowCount = tbody.rows.length;
  const headerCount = thead.rows.length;
  const columnCount = thead.rows[0].cells.length;
  
  status.textContent = `Ï†úÎ™© Ìñâ ${headerCount}Í∞ú, ÏûÖÎ†• Ìñâ ${rowCount}Í∞ú, Ïó¥ ${columnCount}Í∞ú`;
}

for (let i = 0; i < 10; i++) addRow();
initSelectable();  // ‚úÖ ÏÖÄ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ ÌôúÏÑ±ÌôîÎ•º ÏúÑÌïú Ìò∏Ï∂ú Ï∂îÍ∞Ä

function updateSumRowStatus() {
  const tbody = document.getElementById('tbody');
  const sumRows = Array.from(tbody.rows).filter(row => row.cells[0].textContent === 'Ìï©Í≥Ñ');
  const status = document.getElementById('sumRowStatus');
  const list = document.getElementById('sumRowList');
  
  // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
  status.textContent = `ÌòÑÏû¨ ${sumRows.length}Í∞úÏùò Ìï©Í≥Ñ ÌñâÏù¥ ÏûàÏäµÎãàÎã§.`;
  
  // Ìï©Í≥Ñ Ìñâ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
  list.innerHTML = '';
  sumRows.forEach((row, index) => {
    const item = document.createElement('div');
    item.className = 'sum-row-item';
    item.innerHTML = `
      <div class="sum-row-info">Ìï©Í≥Ñ Ìñâ ${index + 1}</div>
      <button class="sum-row-remove" onclick="removeSpecificSumRow(${index})">Ï†úÍ±∞</button>
    `;
    list.appendChild(item);
  });
  
  if (sumRows.length === 0) {
    const item = document.createElement('div');
    item.className = 'sum-row-item';
    item.innerHTML = '<div class="sum-row-info">Ìï©Í≥Ñ ÌñâÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
    list.appendChild(item);
  }
}

function autoAdjustColumnWidths() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  const padding = 20; // ÏÖÄ Ìå®Îî© Í≥†Î†§
  const minWidth = 100; // ÏµúÏÜå ÎÑàÎπÑ
  const maxWidth = 500; // ÏµúÎåÄ ÎÑàÎπÑ
  
  // ÌÖåÏù¥Î∏îÏùÑ Ï†úÎ™© Ìó§ÎçîÏùò "Ìòë" Ïûê ÎÅù Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨
  const title = document.querySelector('h2');
  const titleText = title.textContent;
  const span = document.createElement('span');
  span.style.visibility = 'hidden';
  span.style.position = 'absolute';
  span.style.whiteSpace = 'nowrap';
  span.style.font = window.getComputedStyle(title).font;
  span.textContent = titleText.substring(0, titleText.indexOf('Ìòë') + 1);
  document.body.appendChild(span);
  
  const titleLeft = title.getBoundingClientRect().left;
  const titleWidth = span.offsetWidth;
  const tableLeft = table.getBoundingClientRect().left;
  const offset = (titleLeft + titleWidth) - tableLeft;
  
  document.body.removeChild(span);
  
  table.style.margin = '0';
  table.style.marginLeft = offset + 'px';
  table.style.width = 'auto';
  table.style.tableLayout = 'fixed';
  
  // NO. Ïó¥Ïùò ÎÑàÎπÑ Í≥†Ï†ï
  const noColumnWidth = 60; // NO. Ïó¥Ïùò Í≥†Ï†ï ÎÑàÎπÑ
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const cell = rows[rowIndex].cells[0];
    if (cell) {
      cell.style.width = noColumnWidth + 'px';
      cell.style.minWidth = noColumnWidth + 'px';
    }
  }
  
  // ÎÇòÎ®∏ÏßÄ Ïó¥Ïóê ÎåÄÌï¥ ÏûêÎèô Ï°∞Ï†ï
  for (let colIndex = 1; colIndex < rows[0].cells.length; colIndex++) {
    let maxWidth = minWidth;
    
    // Ìï¥Îãπ Ïó¥Ïùò Î™®Îì† ÏÖÄÏùÑ Í≤ÄÏÇ¨
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell) {
        // ÏûÑÏãú span ÏöîÏÜåÎ•º ÏÉùÏÑ±ÌïòÏó¨ Ïã§Ï†ú ÌÖçÏä§Ìä∏ ÎÑàÎπÑ Ï∏°Ï†ï
        const span = document.createElement('span');
        span.style.visibility = 'hidden';
        span.style.position = 'absolute';
        span.style.whiteSpace = 'nowrap';
        span.style.font = window.getComputedStyle(cell).font;
        span.textContent = cell.textContent;
        document.body.appendChild(span);
        
        const width = span.offsetWidth + padding;
        maxWidth = Math.max(maxWidth, Math.min(width, maxWidth));
        
        document.body.removeChild(span);
      }
    }
    
    // Ìï¥Îãπ Ïó¥Ïùò Î™®Îì† ÏÖÄÏóê ÎÑàÎπÑ Ï†ÅÏö©
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cell = rows[rowIndex].cells[colIndex];
      if (cell) {
        cell.style.width = maxWidth + 'px';
        cell.style.minWidth = maxWidth + 'px';
      }
    }
  }
}

function resetColumnWidths() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // Î™®Îì† ÏÖÄÏùò ÎÑàÎπÑ Ï¥àÍ∏∞Ìôî
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const cells = rows[rowIndex].cells;
    for (let colIndex = 0; colIndex < cells.length; colIndex++) {
      const cell = cells[colIndex];
      cell.style.width = '';
      cell.style.minWidth = '';
    }
  }
  
  // ÌÖåÏù¥Î∏î Î†àÏù¥ÏïÑÏõÉ Ï¥àÍ∏∞Ìôî Î∞è Ï§ëÏïô Ï†ïÎ†¨ Î≥µÏõê
  table.style.width = '100%';
  table.style.tableLayout = 'auto';
  table.style.margin = '0 auto';
}

function adjustRowHeights() {
  const tbody = document.getElementById('tbody');
  const rows = tbody.rows;
  const availableHeight = window.innerHeight - document.querySelector('h2').offsetHeight - document.querySelector('.controls').offsetHeight - 40;
  const rowHeight = Math.max(24, Math.floor(availableHeight / rows.length));
  
  for (let i = 0; i < rows.length; i++) {
    rows[i].style.height = rowHeight + 'px';
    Array.from(rows[i].cells).forEach(cell => {
      cell.style.height = rowHeight + 'px';
      cell.style.padding = '2px';
      cell.style.lineHeight = '1.2';
    });
  }
}

// Ï∞Ω ÌÅ¨Í∏∞Í∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ìñâ ÎÜíÏù¥ Ï°∞Ï†ï
window.addEventListener('resize', adjustRowHeights);

// Ï¥àÍ∏∞ Î°úÎìú Ïãú Ìñâ ÎÜíÏù¥ Ï°∞Ï†ï
window.addEventListener('load', adjustRowHeights);

function autoAdjustRowHeights() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  const minHeight = 24; // ÏµúÏÜå Ìñâ ÎÜíÏù¥
  const maxHeight = 200; // ÏµúÎåÄ Ìñâ ÎÜíÏù¥
  const padding = 6; // ÏÖÄ Ìå®Îî© Í≥†Î†§
  
  // Í∞Å ÌñâÏóê ÎåÄÌï¥
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    let maxHeight = minHeight;
    
    // Ìï¥Îãπ ÌñâÏùò Î™®Îì† ÏÖÄÏùÑ Í≤ÄÏÇ¨
    for (let colIndex = 0; colIndex < row.cells.length; colIndex++) {
      const cell = row.cells[colIndex];
      if (cell) {
        // ÏûÑÏãú div ÏöîÏÜåÎ•º ÏÉùÏÑ±ÌïòÏó¨ Ïã§Ï†ú ÌÖçÏä§Ìä∏ ÎÜíÏù¥ Ï∏°Ï†ï
        const div = document.createElement('div');
        div.style.visibility = 'hidden';
        div.style.position = 'absolute';
        div.style.width = cell.offsetWidth + 'px';
        div.style.padding = window.getComputedStyle(cell).padding;
        div.style.font = window.getComputedStyle(cell).font;
        div.style.whiteSpace = 'pre-wrap';
        div.style.wordBreak = 'break-word';
        div.innerHTML = cell.innerHTML;
        document.body.appendChild(div);
        
        const height = div.offsetHeight + padding;
        maxHeight = Math.max(maxHeight, Math.min(height, maxHeight));
        
        document.body.removeChild(div);
      }
    }
    
    // Ìñâ ÎÜíÏù¥ Ï†ÅÏö©
    row.style.height = maxHeight + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = maxHeight + 'px';
      cell.style.minHeight = maxHeight + 'px';
    });
  }
}

function resetRowHeights() {
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // Î™®Îì† ÌñâÏùò ÎÜíÏù¥ Ï¥àÍ∏∞Ìôî
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = '';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = '';
      cell.style.minHeight = '';
    });
  }
}

function setManualRowHeight() {
  const heightInput = document.getElementById('rowHeightInput');
  const height = parseInt(heightInput.value);
  
  if (isNaN(height) || height < 24 || height > 200) {
    alert('Ìñâ ÎÜíÏù¥Îäî 24pxÏóêÏÑú 200px ÏÇ¨Ïù¥Ïùò Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
    return;
  }
  
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  // Î™®Îì† ÌñâÏóê ÏßÄÏ†ïÎêú ÎÜíÏù¥ Ï†ÅÏö©
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = height + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = height + 'px';
      cell.style.minHeight = height + 'px';
    });
  }
}

// Ìñâ ÎÜíÏù¥ ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
document.getElementById('rowHeightInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    setManualRowHeight();
  }
});

function setRowHeight(height) {
  const slider = document.getElementById('rowHeightSlider');
  const display = document.getElementById('currentRowHeight');
  
  slider.value = height;
  display.textContent = height;
  
  const table = document.getElementById('editableTable');
  const rows = table.rows;
  
  for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
    const row = rows[rowIndex];
    row.style.height = height + 'px';
    Array.from(row.cells).forEach(cell => {
      cell.style.height = height + 'px';
      cell.style.minHeight = height + 'px';
    });
  }
}

// Ïä¨ÎùºÏù¥Îçî Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
document.getElementById('rowHeightSlider').addEventListener('input', function(e) {
  const height = parseInt(e.target.value);
  document.getElementById('currentRowHeight').textContent = height;
  setRowHeight(height);
});

// Ï¥àÍ∏∞ Ìñâ ÎÜíÏù¥ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
function updateRowHeightDisplay() {
  const table = document.getElementById('editableTable');
  const firstRow = table.rows[0];
  const height = firstRow.style.height ? parseInt(firstRow.style.height) : 24;
  
  const slider = document.getElementById('rowHeightSlider');
  const display = document.getElementById('currentRowHeight');
  
  slider.value = height;
  display.textContent = height;
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ Ìñâ ÎÜíÏù¥ ÌëúÏãú
window.addEventListener('load', updateRowHeightDisplay);

function toggleRowHeightPanel() {
  const panel = document.getElementById('rowHeightPanel');
  panel.style.display = 'block';
  initRowHeightPanelDrag();
  updateRowHeightDisplay();
}

function cancelRowHeightPanel() {
  const panel = document.getElementById('rowHeightPanel');
  panel.style.display = 'none';
  panel.style.transform = 'translate(0, 0)';
}

function initRowHeightPanelDrag() {
  const panel = document.getElementById('rowHeightPanel');
  const title = panel.querySelector('.title');
  let isDragging = false;
  let currentX;
  let currentY;
  let initialX;
  let initialY;
  let xOffset = 0;
  let yOffset = 0;

  title.addEventListener('mousedown', dragStart);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', dragEnd);

  function dragStart(e) {
    initialX = e.clientX - xOffset;
    initialY = e.clientY - yOffset;
    if (e.target === title) {
      isDragging = true;
    }
  }

  function drag(e) {
    if (isDragging) {
      e.preventDefault();
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
      xOffset = currentX;
      yOffset = currentY;
      setTranslate(currentX, currentY, panel);
    }
  }

  function dragEnd(e) {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
  }

  function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}
</script>

</body>
</html>